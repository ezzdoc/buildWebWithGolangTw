<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>13.4 | 使用 Golang 打造 Web 應用程式</title>


<link rel="stylesheet" href="/buildWebWithGolangTw/book.min.89885fa0429ec73067282f26fc0c6d38cfc617a443ec4e835d47b821c52c6e92.css" integrity="sha256-iYhfoEKexzBnKC8m/AxtOM/GF6RD7E6DXUe4IcUsbpI=">


<script defer src="/buildWebWithGolangTw/search.min.1a26f030063cd84b7dd0472b3e255bc21c62c31322ab49b56f536fba41b42496.js" integrity="sha256-GibwMAY82Et90EcrPiVbwhxiwxMiq0m1b1NvukG0JJY="></script>



<link rel="icon" href="/buildWebWithGolangTw/favicon.png" type="image/x-icon">

<base href="https://ezzdoc.com/buildWebWithGolangTw/">


<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

  
</head>

<body>
  <input type="checkbox" class="hidden" id="menu-control" />
  <main class="flex container">

    <aside class="book-menu fixed">
      <nav>
<h2 class="book-brand">
  <a href="https://ezzdoc.com/buildWebWithGolangTw/"><span>使用 Golang 打造 Web 應用程式</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" placeholder="Search" id="book-search-input" maxlength="64" readonly />
  <div class="book-search-spinner spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>





    
  
  
  

  <style>
  nav ul a[href$="\2f buildWebWithGolangTw\2f docs\2f 13.4\2f "] {
      color: #004ed0;
  }
  </style>

<ul>
<li><a href="/buildWebWithGolangTw/docs/preface/">目錄</a></li>
<li><a href="/buildWebWithGolangTw/docs/01.0/">1.Go 環境配置</a>

<ul>
<li><a href="/buildWebWithGolangTw/docs/01.1/">1.1 安裝 Go</a></li>
<li><a href="/buildWebWithGolangTw/docs/01.2/">1.2 GOPATH 與工作空間</a></li>
<li><a href="/buildWebWithGolangTw/docs/01.3/">1.3 Go 命令</a></li>
<li><a href="/buildWebWithGolangTw/docs/01.4/">1.4 Go 開發工具</a></li>
<li><a href="/buildWebWithGolangTw/docs/01.5/">1.5 小結</a></li>
</ul></li>
<li><a href="/buildWebWithGolangTw/docs/02.0/">2.Go 語言基礎</a>

<ul>
<li><a href="/buildWebWithGolangTw/docs/02.1/">2.1 你好，Go</a></li>
<li><a href="/buildWebWithGolangTw/docs/02.2/">2.2 Go 基礎</a></li>
<li><a href="/buildWebWithGolangTw/docs/02.3/">2.3 流程和函式</a></li>
<li><a href="/buildWebWithGolangTw/docs/02.4/">2.4 struct</a></li>
<li><a href="/buildWebWithGolangTw/docs/02.5/">2.5 物件導向</a></li>
<li><a href="/buildWebWithGolangTw/docs/02.6/">2.6 interface</a></li>
<li><a href="/buildWebWithGolangTw/docs/02.7/">2.7 併發</a></li>
<li><a href="/buildWebWithGolangTw/docs/02.8/">2.8 小結</a></li>
</ul></li>
<li><a href="/buildWebWithGolangTw/docs/03.0/">3.Web 基礎</a>

<ul>
<li><a href="/buildWebWithGolangTw/docs/03.1/">3.1 web 工作方式</a></li>
<li><a href="/buildWebWithGolangTw/docs/03.2/">3.2 Go 建立一個簡單的 web 服務</a></li>
<li><a href="/buildWebWithGolangTw/docs/03.3/">3.3 Go 如何使得 web 工作</a></li>
<li><a href="/buildWebWithGolangTw/docs/03.4/">3.4 Go 的 http 套件詳解</a></li>
<li><a href="/buildWebWithGolangTw/docs/03.5/">3.5 小結</a></li>
</ul></li>
<li><a href="/buildWebWithGolangTw/docs/04.0/">4.表單</a>

<ul>
<li><a href="/buildWebWithGolangTw/docs/04.1/">4.1 處理表單的輸入</a></li>
<li><a href="/buildWebWithGolangTw/docs/04.2/">4.2 驗證表單的輸入</a></li>
<li><a href="/buildWebWithGolangTw/docs/04.3/">4.3 預防跨站指令碼</a></li>
<li><a href="/buildWebWithGolangTw/docs/04.4/">4.4 防止多次提交表單</a></li>
<li><a href="/buildWebWithGolangTw/docs/04.5/">4.5 處理檔案上傳</a></li>
<li><a href="/buildWebWithGolangTw/docs/04.6/">4.6 小結</a></li>
</ul></li>
<li><a href="/buildWebWithGolangTw/docs/05.0/">5.訪問資料庫</a>

<ul>
<li><a href="/buildWebWithGolangTw/docs/05.1/">5.1 database/sql 介面</a></li>
<li><a href="/buildWebWithGolangTw/docs/05.2/">5.2 使用 MySQL 資料庫</a></li>
<li><a href="/buildWebWithGolangTw/docs/05.3/">5.3 使用 SQLite 資料庫</a></li>
<li><a href="/buildWebWithGolangTw/docs/05.4/">5.4 使用 PostgreSQL 資料庫</a></li>
<li><a href="/buildWebWithGolangTw/docs/05.5/">5.5 使用 Beego orm 函式庫進行 ORM 開發</a></li>
<li><a href="/buildWebWithGolangTw/docs/05.6/">5.6 NOSQL 資料庫操作</a></li>
<li><a href="/buildWebWithGolangTw/docs/05.7/">5.7 小結</a></li>
</ul></li>
<li><a href="/buildWebWithGolangTw/docs/06.0/">6.session 和資料儲存</a>

<ul>
<li><a href="/buildWebWithGolangTw/docs/06.1/">6.1 session 和 cookie</a></li>
<li><a href="/buildWebWithGolangTw/docs/06.2/">6.2 Go 如何使用 session</a></li>
<li><a href="/buildWebWithGolangTw/docs/06.3/">6.3 session 儲存</a></li>
<li><a href="/buildWebWithGolangTw/docs/06.4/">6.4 預防 session 劫持</a></li>
<li><a href="/buildWebWithGolangTw/docs/06.5/">6.5 小結</a></li>
</ul></li>
<li><a href="/buildWebWithGolangTw/docs/07.0/">7.文字檔案處理</a>

<ul>
<li><a href="/buildWebWithGolangTw/docs/07.1/">7.1 XML 處理</a></li>
<li><a href="/buildWebWithGolangTw/docs/07.2/">7.2 JSON 處理</a></li>
<li><a href="/buildWebWithGolangTw/docs/07.3/">7.3 正則處理</a></li>
<li><a href="/buildWebWithGolangTw/docs/07.4/">7.4 範本處理</a></li>
<li><a href="/buildWebWithGolangTw/docs/07.5/">7.5 檔案操作</a></li>
<li><a href="/buildWebWithGolangTw/docs/07.6/">7.6 字串處理</a></li>
<li><a href="/buildWebWithGolangTw/docs/07.7/">7.7 小結</a></li>
</ul></li>
<li><a href="/buildWebWithGolangTw/docs/08.0/">8.Web 服務</a>

<ul>
<li><a href="/buildWebWithGolangTw/docs/08.1/">8.1 Socket 程式設計</a></li>
<li><a href="/buildWebWithGolangTw/docs/08.2/">8.2 WebSocket</a></li>
<li><a href="/buildWebWithGolangTw/docs/08.3/">8.3 REST</a></li>
<li><a href="/buildWebWithGolangTw/docs/08.4/">8.4 RPC</a></li>
<li><a href="/buildWebWithGolangTw/docs/08.5/">8.5 小結</a></li>
</ul></li>
<li><a href="/buildWebWithGolangTw/docs/09.0/">9.安全與加密</a>

<ul>
<li><a href="/buildWebWithGolangTw/docs/09.1/">9.1 預防 CSRF 攻擊</a></li>
<li><a href="/buildWebWithGolangTw/docs/09.2/">9.2 確保輸入過濾</a></li>
<li><a href="/buildWebWithGolangTw/docs/09.3/">9.3 避免 XSS 攻擊</a></li>
<li><a href="/buildWebWithGolangTw/docs/09.4/">9.4 避免 SQL 注入</a></li>
<li><a href="/buildWebWithGolangTw/docs/09.5/">9.5 儲存密碼</a></li>
<li><a href="/buildWebWithGolangTw/docs/09.6/">9.6 加密和解密資料</a></li>
<li><a href="/buildWebWithGolangTw/docs/09.7/">9.7 小結</a></li>
</ul></li>
<li><a href="/buildWebWithGolangTw/docs/10.0/">10.國際化和本地化</a>

<ul>
<li><a href="/buildWebWithGolangTw/docs/10.1/">10.1 設定預設地區</a></li>
<li><a href="/buildWebWithGolangTw/docs/10.2/">10.2 本地化資源</a></li>
<li><a href="/buildWebWithGolangTw/docs/10.3/">10.3 國際化站點</a></li>
<li><a href="/buildWebWithGolangTw/docs/10.4/">10.4 小結</a></li>
</ul></li>
<li><a href="/buildWebWithGolangTw/docs/11.0/">11.錯誤處理，除錯和測試</a>

<ul>
<li><a href="/buildWebWithGolangTw/docs/11.1/">11.1 錯誤處理</a></li>
<li><a href="/buildWebWithGolangTw/docs/11.2/">11.2 使用 GDB 除錯</a></li>
<li><a href="/buildWebWithGolangTw/docs/11.3/">11.3 Go 怎麼寫測試案例</a></li>
<li><a href="/buildWebWithGolangTw/docs/11.4/">11.4 小結</a></li>
</ul></li>
<li><a href="/buildWebWithGolangTw/docs/12.0/">12.部署與維護</a>

<ul>
<li><a href="/buildWebWithGolangTw/docs/12.1/">12.1 應用日誌</a></li>
<li><a href="/buildWebWithGolangTw/docs/12.2/">12.2 網站錯誤處理</a></li>
<li><a href="/buildWebWithGolangTw/docs/12.3/">12.3 應用部署</a></li>
<li><a href="/buildWebWithGolangTw/docs/12.4/">12.4 備份和還原</a></li>
<li><a href="/buildWebWithGolangTw/docs/12.5/">12.5 小結</a></li>
</ul></li>
<li><a href="/buildWebWithGolangTw/docs/13.0/">13.如何設計一個 Web 框架</a>

<ul>
<li><a href="/buildWebWithGolangTw/docs/13.1/">13.1 專案規劃</a></li>
<li><a href="/buildWebWithGolangTw/docs/13.2/">13.2 自訂路由器設計</a></li>
<li><a href="/buildWebWithGolangTw/docs/13.3/">13.3 controller 設計</a></li>
<li><a href="/buildWebWithGolangTw/docs/13.4/">13.4 日誌和配置設計</a></li>
<li><a href="/buildWebWithGolangTw/docs/13.5/">13.5 實現部落格的增刪改</a></li>
<li><a href="/buildWebWithGolangTw/docs/13.6/">13.6 小結</a></li>
</ul></li>
<li><a href="/buildWebWithGolangTw/docs/14.0/">14.擴充套件 Web 框架</a>

<ul>
<li><a href="/buildWebWithGolangTw/docs/14.1/">14.1 靜態檔案支援</a></li>
<li><a href="/buildWebWithGolangTw/docs/14.2/">14.2 Session 支援</a></li>
<li><a href="/buildWebWithGolangTw/docs/14.3/">14.3 表單支援</a></li>
<li><a href="/buildWebWithGolangTw/docs/14.4/">14.4 使用者認證</a></li>
<li><a href="/buildWebWithGolangTw/docs/14.5/">14.5 多語言支援</a></li>
<li><a href="/buildWebWithGolangTw/docs/14.6/">14.6 pprof 支援</a></li>
<li><a href="/buildWebWithGolangTw/docs/14.7/">14.7 小結</a></li>
</ul></li>
<li><a href="/buildWebWithGolangTw/docs/ref/">附錄 A 參考資料</a></li>
</ul>







</nav>


<script>
(function() {
  var menu = document.querySelector("aside.book-menu nav");
  addEventListener("beforeunload", function(event) {
    localStorage.setItem("menu.scrollTop", menu.scrollTop);
  });
  menu.scrollTop = localStorage.getItem("menu.scrollTop");
})();
</script>

    </aside>

    <div class="book-page">
      <header class="flex align-center justify-between book-header">
  <label for="menu-control">
    <img src="/buildWebWithGolangTw/svg/menu.svg" alt="Menu" />
  </label>
  <strong>13.4</strong>
</header>

      
<article class="markdown">

<h1 id="13-4-日誌和配置設計">13.4 日誌和配置設計</h1>

<h2 id="日誌和配置的重要性">日誌和配置的重要性</h2>

<p>前面已經介紹過日誌在我們程式開發中起著很重要的作用，透過日誌我們可以記錄除錯我們的資訊，當初介紹過一個日誌系統 seelog，根據不同的 level 輸出不同的日誌，這個對於程式開發和程式部署來說至關重要。我們可以在程式開發中設定 level 低一點，部署的時候把 level 設定高，這樣我們開發中的除錯資訊可以遮蔽掉。</p>

<p>配置模組對於應用部署牽涉到伺服器不同的一些配置資訊非常有用，例如一些資料庫配置資訊、監聽埠、監聽地址等都是可以透過配置檔案來配置，這樣我們的應用程式就具有很強的靈活性，可以透過配置檔案的配置部署在不同的機器上，可以連線不同的資料庫之類別的。</p>

<h2 id="beego-的日誌設計">beego 的日誌設計</h2>

<p>beego 的日誌設計部署思路來自於 seelog，根據不同的 level 來記錄日誌，但是 beego 設計的日誌系統比較輕量級，採用了系統的 log.Logger 介面，預設輸出到 os.Stdout，使用者可以實現這個介面然後透過 beego.SetLogger 設定自訂的輸出，詳細的實現如下所示：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Go" data-lang="Go"><span style="color:#75715e">// Log levels to control the logging output.
</span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> (
	<span style="color:#a6e22e">LevelTrace</span> = <span style="color:#66d9ef">iota</span>
	<span style="color:#a6e22e">LevelDebug</span>
	<span style="color:#a6e22e">LevelInfo</span>
	<span style="color:#a6e22e">LevelWarning</span>
	<span style="color:#a6e22e">LevelError</span>
	<span style="color:#a6e22e">LevelCritical</span>
)

<span style="color:#75715e">// logLevel controls the global log level used by the logger.
</span><span style="color:#75715e"></span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">level</span> = <span style="color:#a6e22e">LevelTrace</span>

<span style="color:#75715e">// LogLevel returns the global log level and can be used in
</span><span style="color:#75715e">// own implementations of the logger interface.
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">Level</span>() <span style="color:#66d9ef">int</span> {
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">level</span>
}

<span style="color:#75715e">// SetLogLevel sets the global log level used by the simple
</span><span style="color:#75715e">// logger.
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">SetLevel</span>(<span style="color:#a6e22e">l</span> <span style="color:#66d9ef">int</span>) {
	<span style="color:#a6e22e">level</span> = <span style="color:#a6e22e">l</span>
}</code></pre></div>
<p>上面這一段實現了日誌系統的日誌分級，預設的級別是 Trace，使用者透過 SetLevel 可以設定不同的分級。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Go" data-lang="Go"><span style="color:#75715e">// logger references the used application logger.
</span><span style="color:#75715e"></span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">BeeLogger</span> = <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">New</span>(<span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Stdout</span>, <span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Ldate</span>|<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Ltime</span>)

<span style="color:#75715e">// SetLogger sets a new logger.
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">SetLogger</span>(<span style="color:#a6e22e">l</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Logger</span>) {
	<span style="color:#a6e22e">BeeLogger</span> = <span style="color:#a6e22e">l</span>
}

<span style="color:#75715e">// Trace logs a message at trace level.
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">Trace</span>(<span style="color:#a6e22e">v</span> <span style="color:#f92672">...</span><span style="color:#66d9ef">interface</span>{}) {
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">level</span> <span style="color:#f92672">&lt;=</span> <span style="color:#a6e22e">LevelTrace</span> {
		<span style="color:#a6e22e">BeeLogger</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;[T] %v\n&#34;</span>, <span style="color:#a6e22e">v</span>)
	}
}

<span style="color:#75715e">// Debug logs a message at debug level.
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">Debug</span>(<span style="color:#a6e22e">v</span> <span style="color:#f92672">...</span><span style="color:#66d9ef">interface</span>{}) {
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">level</span> <span style="color:#f92672">&lt;=</span> <span style="color:#a6e22e">LevelDebug</span> {
		<span style="color:#a6e22e">BeeLogger</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;[D] %v\n&#34;</span>, <span style="color:#a6e22e">v</span>)
	}
}

<span style="color:#75715e">// Info logs a message at info level.
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">Info</span>(<span style="color:#a6e22e">v</span> <span style="color:#f92672">...</span><span style="color:#66d9ef">interface</span>{}) {
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">level</span> <span style="color:#f92672">&lt;=</span> <span style="color:#a6e22e">LevelInfo</span> {
		<span style="color:#a6e22e">BeeLogger</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;[I] %v\n&#34;</span>, <span style="color:#a6e22e">v</span>)
	}
}

<span style="color:#75715e">// Warning logs a message at warning level.
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">Warn</span>(<span style="color:#a6e22e">v</span> <span style="color:#f92672">...</span><span style="color:#66d9ef">interface</span>{}) {
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">level</span> <span style="color:#f92672">&lt;=</span> <span style="color:#a6e22e">LevelWarning</span> {
		<span style="color:#a6e22e">BeeLogger</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;[W] %v\n&#34;</span>, <span style="color:#a6e22e">v</span>)
	}
}

<span style="color:#75715e">// Error logs a message at error level.
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">Error</span>(<span style="color:#a6e22e">v</span> <span style="color:#f92672">...</span><span style="color:#66d9ef">interface</span>{}) {
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">level</span> <span style="color:#f92672">&lt;=</span> <span style="color:#a6e22e">LevelError</span> {
		<span style="color:#a6e22e">BeeLogger</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;[E] %v\n&#34;</span>, <span style="color:#a6e22e">v</span>)
	}
}

<span style="color:#75715e">// Critical logs a message at critical level.
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">Critical</span>(<span style="color:#a6e22e">v</span> <span style="color:#f92672">...</span><span style="color:#66d9ef">interface</span>{}) {
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">level</span> <span style="color:#f92672">&lt;=</span> <span style="color:#a6e22e">LevelCritical</span> {
		<span style="color:#a6e22e">BeeLogger</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;[C] %v\n&#34;</span>, <span style="color:#a6e22e">v</span>)
	}
}</code></pre></div>
<p>上面這一段程式碼預設初始化了一個 BeeLogger 物件，預設輸出到 os.Stdout，使用者可以透過 beego.SetLogger 來設定實現了 logger 的介面輸出。這裡面實現了六個函式：</p>

<ul>
<li>Trace（一般的記錄資訊，舉例如下：）

<ul>
<li>&ldquo;Entered parse function validation block&rdquo;</li>
<li>&ldquo;Validation: entered second &lsquo;if&rsquo;&rdquo;</li>
<li>&ldquo;Dictionary &lsquo;Dict&rsquo; is empty. Using default value&rdquo;</li>
</ul></li>
<li>Debug（除錯資訊，舉例如下：）

<ul>
<li>&ldquo;Web page requested: <a href="http://somesite.com">http://somesite.com</a> Params=&lsquo;&hellip;&rsquo;&rdquo;</li>
<li>&ldquo;Response generated. Response size: 10000. Sending.&rdquo;</li>
<li>&ldquo;New file received. Type:PNG Size:20000&rdquo;</li>
</ul></li>
<li>Info（列印資訊，舉例如下：）

<ul>
<li>&ldquo;Web server restarted&rdquo;</li>
<li>&ldquo;Hourly statistics: Requested pages: 12345 Errors: 123 &hellip;&rdquo;</li>
<li>&ldquo;Service paused. Waiting for &lsquo;resume&rsquo; call&rdquo;</li>
</ul></li>
<li>Warn（警告資訊，舉例如下：）

<ul>
<li>&ldquo;Cache corrupted for file=&lsquo;test.file&rsquo;. Reading from back-end&rdquo;</li>
<li>&ldquo;Database 192.168.0.7/DB not responding. Using backup 192.168.0.8/DB&rdquo;</li>
<li>&ldquo;No response from statistics server. Statistics not sent&rdquo;</li>
</ul></li>
<li>Error（錯誤資訊，舉例如下：）

<ul>
<li>&ldquo;Internal error. Cannot process request #12345 Error:&hellip;.&rdquo;</li>
<li>&ldquo;Cannot perform login: credentials DB not responding&rdquo;</li>
</ul></li>
<li>Critical（致命錯誤，舉例如下：）

<ul>
<li>&ldquo;Critical panic received: &hellip;. Shutting down&rdquo;</li>
<li>&ldquo;Fatal error: &hellip; App is shutting down to prevent data corruption or loss&rdquo;</li>
</ul></li>
</ul>

<p>可以看到每個函式裡面都有對 level 的判斷，所以如果我們在部署的時候設定了 level=LevelWarning，那麼 Trace、Debug、Info 這三個函式都不會有任何的輸出，以此類推。</p>

<h2 id="beego-的配置設計">beego 的配置設計</h2>

<p>配置資訊的解析，beego 實現了一個 key=value 的配置檔案讀取，類似 ini 配置檔案的格式，就是一個檔案解析的過程，然後把解析的資料儲存到 map 中，最後在呼叫的時候通過幾個 string、int 之類別的函式呼叫回傳相應的值，具體的實現請看下面：</p>

<p>首先定義了一些 ini 配置檔案的一些全域常數：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Go" data-lang="Go"><span style="color:#66d9ef">var</span> (
	<span style="color:#a6e22e">bComment</span> = []<span style="color:#66d9ef">byte</span>{<span style="color:#e6db74">&#39;#&#39;</span>}
	<span style="color:#a6e22e">bEmpty</span>   = []<span style="color:#66d9ef">byte</span>{}
	<span style="color:#a6e22e">bEqual</span>   = []<span style="color:#66d9ef">byte</span>{<span style="color:#e6db74">&#39;=&#39;</span>}
	<span style="color:#a6e22e">bDQuote</span>  = []<span style="color:#66d9ef">byte</span>{<span style="color:#e6db74">&#39;&#34;&#39;</span>}
)</code></pre></div>
<p>定義了配置檔案的格式：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Go" data-lang="Go"><span style="color:#75715e">// A Config represents the configuration.
</span><span style="color:#75715e"></span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Config</span> <span style="color:#66d9ef">struct</span> {
	<span style="color:#a6e22e">filename</span> <span style="color:#66d9ef">string</span>
	<span style="color:#a6e22e">comment</span>  <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">int</span>][]<span style="color:#66d9ef">string</span>  <span style="color:#75715e">// id: []{comment, key...}; id 1 is for main comment.
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">data</span>     <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">string</span> <span style="color:#75715e">// key: value
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">offset</span>   <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">int64</span>  <span style="color:#75715e">// key: offset; for editing.
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">sync</span>.<span style="color:#a6e22e">RWMutex</span>
}</code></pre></div>
<p>定義了解析檔案的函式，解析檔案的過程是開啟檔案，然後一行一行的讀取，解析註釋、空行和 key=value 資料：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Go" data-lang="Go"><span style="color:#75715e">// ParseFile creates a new Config and parses the file configuration from the
</span><span style="color:#75715e">// named file.
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">LoadConfig</span>(<span style="color:#a6e22e">name</span> <span style="color:#66d9ef">string</span>) (<span style="color:#f92672">*</span><span style="color:#a6e22e">Config</span>, <span style="color:#66d9ef">error</span>) {
	<span style="color:#a6e22e">file</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Open</span>(<span style="color:#a6e22e">name</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">err</span>
	}

	<span style="color:#a6e22e">cfg</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">Config</span>{
		<span style="color:#a6e22e">file</span>.<span style="color:#a6e22e">Name</span>(),
		make(<span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">int</span>][]<span style="color:#66d9ef">string</span>),
		make(<span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">string</span>),
		make(<span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">int64</span>),
		<span style="color:#a6e22e">sync</span>.<span style="color:#a6e22e">RWMutex</span>{},
	}
	<span style="color:#a6e22e">cfg</span>.<span style="color:#a6e22e">Lock</span>()
	<span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">cfg</span>.<span style="color:#a6e22e">Unlock</span>()
	<span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">file</span>.<span style="color:#a6e22e">Close</span>()

	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">comment</span> <span style="color:#a6e22e">bytes</span>.<span style="color:#a6e22e">Buffer</span>
	<span style="color:#a6e22e">buf</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">bufio</span>.<span style="color:#a6e22e">NewReader</span>(<span style="color:#a6e22e">file</span>)

	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">nComment</span>, <span style="color:#a6e22e">off</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">0</span>, int64(<span style="color:#ae81ff">1</span>); ; {
		<span style="color:#a6e22e">line</span>, <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">buf</span>.<span style="color:#a6e22e">ReadLine</span>()
		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">==</span> <span style="color:#a6e22e">io</span>.<span style="color:#a6e22e">EOF</span> {
			<span style="color:#66d9ef">break</span>
		}
		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">bytes</span>.<span style="color:#a6e22e">Equal</span>(<span style="color:#a6e22e">line</span>, <span style="color:#a6e22e">bEmpty</span>) {
			<span style="color:#66d9ef">continue</span>
		}

		<span style="color:#a6e22e">off</span> <span style="color:#f92672">+=</span> int64(len(<span style="color:#a6e22e">line</span>))

		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">bytes</span>.<span style="color:#a6e22e">HasPrefix</span>(<span style="color:#a6e22e">line</span>, <span style="color:#a6e22e">bComment</span>) {
			<span style="color:#a6e22e">line</span> = <span style="color:#a6e22e">bytes</span>.<span style="color:#a6e22e">TrimLeft</span>(<span style="color:#a6e22e">line</span>, <span style="color:#e6db74">&#34;#&#34;</span>)
			<span style="color:#a6e22e">line</span> = <span style="color:#a6e22e">bytes</span>.<span style="color:#a6e22e">TrimLeftFunc</span>(<span style="color:#a6e22e">line</span>, <span style="color:#a6e22e">unicode</span>.<span style="color:#a6e22e">IsSpace</span>)
			<span style="color:#a6e22e">comment</span>.<span style="color:#a6e22e">Write</span>(<span style="color:#a6e22e">line</span>)
			<span style="color:#a6e22e">comment</span>.<span style="color:#a6e22e">WriteByte</span>(<span style="color:#e6db74">&#39;\n&#39;</span>)
			<span style="color:#66d9ef">continue</span>
		}
		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">comment</span>.<span style="color:#a6e22e">Len</span>() <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span> {
			<span style="color:#a6e22e">cfg</span>.<span style="color:#a6e22e">comment</span>[<span style="color:#a6e22e">nComment</span>] = []<span style="color:#66d9ef">string</span>{<span style="color:#a6e22e">comment</span>.<span style="color:#a6e22e">String</span>()}
			<span style="color:#a6e22e">comment</span>.<span style="color:#a6e22e">Reset</span>()
			<span style="color:#a6e22e">nComment</span><span style="color:#f92672">++</span>
		}

		<span style="color:#a6e22e">val</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">bytes</span>.<span style="color:#a6e22e">SplitN</span>(<span style="color:#a6e22e">line</span>, <span style="color:#a6e22e">bEqual</span>, <span style="color:#ae81ff">2</span>)
		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">bytes</span>.<span style="color:#a6e22e">HasPrefix</span>(<span style="color:#a6e22e">val</span>[<span style="color:#ae81ff">1</span>], <span style="color:#a6e22e">bDQuote</span>) {
			<span style="color:#a6e22e">val</span>[<span style="color:#ae81ff">1</span>] = <span style="color:#a6e22e">bytes</span>.<span style="color:#a6e22e">Trim</span>(<span style="color:#a6e22e">val</span>[<span style="color:#ae81ff">1</span>], <span style="color:#e6db74">`&#34;`</span>)
		}

		<span style="color:#a6e22e">key</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">strings</span>.<span style="color:#a6e22e">TrimSpace</span>(string(<span style="color:#a6e22e">val</span>[<span style="color:#ae81ff">0</span>]))
		<span style="color:#a6e22e">cfg</span>.<span style="color:#a6e22e">comment</span>[<span style="color:#a6e22e">nComment</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] = append(<span style="color:#a6e22e">cfg</span>.<span style="color:#a6e22e">comment</span>[<span style="color:#a6e22e">nComment</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>], <span style="color:#a6e22e">key</span>)
		<span style="color:#a6e22e">cfg</span>.<span style="color:#a6e22e">data</span>[<span style="color:#a6e22e">key</span>] = <span style="color:#a6e22e">strings</span>.<span style="color:#a6e22e">TrimSpace</span>(string(<span style="color:#a6e22e">val</span>[<span style="color:#ae81ff">1</span>]))
		<span style="color:#a6e22e">cfg</span>.<span style="color:#a6e22e">offset</span>[<span style="color:#a6e22e">key</span>] = <span style="color:#a6e22e">off</span>
	}
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">cfg</span>, <span style="color:#66d9ef">nil</span>
}</code></pre></div>
<p>下面實現了一些讀取配置檔案的函式，回傳的值確定為 bool、int、float64 或 string：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Go" data-lang="Go"><span style="color:#75715e">// Bool returns the boolean value for a given key.
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Config</span>) <span style="color:#a6e22e">Bool</span>(<span style="color:#a6e22e">key</span> <span style="color:#66d9ef">string</span>) (<span style="color:#66d9ef">bool</span>, <span style="color:#66d9ef">error</span>) {
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">strconv</span>.<span style="color:#a6e22e">ParseBool</span>(<span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">data</span>[<span style="color:#a6e22e">key</span>])
}

<span style="color:#75715e">// Int returns the integer value for a given key.
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Config</span>) <span style="color:#a6e22e">Int</span>(<span style="color:#a6e22e">key</span> <span style="color:#66d9ef">string</span>) (<span style="color:#66d9ef">int</span>, <span style="color:#66d9ef">error</span>) {
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">strconv</span>.<span style="color:#a6e22e">Atoi</span>(<span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">data</span>[<span style="color:#a6e22e">key</span>])
}

<span style="color:#75715e">// Float returns the float value for a given key.
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Config</span>) <span style="color:#a6e22e">Float</span>(<span style="color:#a6e22e">key</span> <span style="color:#66d9ef">string</span>) (<span style="color:#66d9ef">float64</span>, <span style="color:#66d9ef">error</span>) {
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">strconv</span>.<span style="color:#a6e22e">ParseFloat</span>(<span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">data</span>[<span style="color:#a6e22e">key</span>], <span style="color:#ae81ff">64</span>)
}

<span style="color:#75715e">// String returns the string value for a given key.
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Config</span>) <span style="color:#a6e22e">String</span>(<span style="color:#a6e22e">key</span> <span style="color:#66d9ef">string</span>) <span style="color:#66d9ef">string</span> {
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">data</span>[<span style="color:#a6e22e">key</span>]
}</code></pre></div>
<h2 id="應用指南">應用指南</h2>

<p>下面這個函式是我一個應用中的例子，用來取得遠端 url 地址的 json 資料，實現如下：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Go" data-lang="Go"><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">GetJson</span>() {
	<span style="color:#a6e22e">resp</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">Get</span>(<span style="color:#a6e22e">beego</span>.<span style="color:#a6e22e">AppConfig</span>.<span style="color:#a6e22e">String</span>(<span style="color:#e6db74">&#34;url&#34;</span>))
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">beego</span>.<span style="color:#a6e22e">Critical</span>(<span style="color:#e6db74">&#34;http get info error&#34;</span>)
		<span style="color:#66d9ef">return</span>
	}
	<span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">resp</span>.<span style="color:#a6e22e">Body</span>.<span style="color:#a6e22e">Close</span>()
	<span style="color:#a6e22e">body</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">ioutil</span>.<span style="color:#a6e22e">ReadAll</span>(<span style="color:#a6e22e">resp</span>.<span style="color:#a6e22e">Body</span>)
	<span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">json</span>.<span style="color:#a6e22e">Unmarshal</span>(<span style="color:#a6e22e">body</span>, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">AllInfo</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">beego</span>.<span style="color:#a6e22e">Critical</span>(<span style="color:#e6db74">&#34;error:&#34;</span>, <span style="color:#a6e22e">err</span>)
	}
}</code></pre></div>
<p>函式中呼叫了框架的日誌函式<code>beego.Critical</code>函式用來報錯，呼叫了<code>beego.AppConfig.String(&quot;url&quot;)</code>用來取得配置檔案中的資訊，配置檔案的資訊如下(app.conf)：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Go" data-lang="Go"><span style="color:#a6e22e">appname</span> = <span style="color:#a6e22e">hs</span>
<span style="color:#a6e22e">url</span> =<span style="color:#e6db74">&#34;http://www.api.com/api.html&#34;</span></code></pre></div>
<h2 id="links">links</h2>

<ul>
<li><a href="docs/preface">目錄</a></li>
<li>上一章: <a href="docs/13.3">controller 設計</a></li>
<li>下一節: <a href="docs/13.5">實現部落格的增刪改</a></li>
</ul>
</article>

      
<div class="book-footer justify-between">
  
  <div>
    
    <a href="/commit/fda25aafea9413c8ec77f5df29d5f6bb5f7dc3a6" title='Last modified Sep 21, 2019 by Jiuxiao' target="_blank" rel="noopener">
      <img src="/buildWebWithGolangTw/svg/calendar.svg" alt="Changed" /> Sep 21, 2019
    </a>
  </div>
  
  
</div>


      
    </div>

    
  

  <aside class="book-toc level-3 fixed">
    <nav id="TableOfContents">
<ul>
<li><a href="#13-4-日誌和配置設計">13.4 日誌和配置設計</a>
<ul>
<li><a href="#日誌和配置的重要性">日誌和配置的重要性</a></li>
<li><a href="#beego-的日誌設計">beego 的日誌設計</a></li>
<li><a href="#beego-的配置設計">beego 的配置設計</a></li>
<li><a href="#應用指南">應用指南</a></li>
<li><a href="#links">links</a></li>
</ul></li>
</ul>
</nav>
  </aside>



  </main>

  
  
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-148025936-2', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

</body>

</html>
