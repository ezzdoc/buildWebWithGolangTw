<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>07.4 | 使用 Golang 打造 Web 應用程式</title>


<link rel="stylesheet" href="/buildWebWithGolangTw/book.min.89885fa0429ec73067282f26fc0c6d38cfc617a443ec4e835d47b821c52c6e92.css" integrity="sha256-iYhfoEKexzBnKC8m/AxtOM/GF6RD7E6DXUe4IcUsbpI=">


<script defer src="/buildWebWithGolangTw/search.min.4762838110f5450a8a33fcbe56c7ce734d09867f3e9ab5c1e6f7bbec99b65c68.js" integrity="sha256-R2KDgRD1RQqKM/y&#43;VsfOc00Jhn8&#43;mrXB5ve77Jm2XGg="></script>



<link rel="icon" href="/buildWebWithGolangTw/favicon.png" type="image/x-icon">

<base href="https://ezzdoc.com/buildWebWithGolangTw/">


<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

  
</head>

<body>
  <input type="checkbox" class="hidden" id="menu-control" />
  <main class="flex container">

    <aside class="book-menu fixed">
      <nav>
<h2 class="book-brand">
  <a href="https://ezzdoc.com/buildWebWithGolangTw/"><span>使用 Golang 打造 Web 應用程式</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" placeholder="Search" id="book-search-input" maxlength="64" readonly />
  <div class="book-search-spinner spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>





    
  
  
  

  <style>
  nav ul a[href$="\2f buildWebWithGolangTw\2f docs\2f 07.4\2f "] {
      color: #004ed0;
  }
  </style>

<ul>
<li><a href="/buildWebWithGolangTw/docs/preface/">目錄</a></li>
<li><a href="/buildWebWithGolangTw/docs/01.0/">1.Go 環境配置</a>

<ul>
<li><a href="/buildWebWithGolangTw/docs/01.1/">1.1 安裝 Go</a></li>
<li><a href="/buildWebWithGolangTw/docs/01.2/">1.2 GOPATH 與工作空間</a></li>
<li><a href="/buildWebWithGolangTw/docs/01.3/">1.3 Go 命令</a></li>
<li><a href="/buildWebWithGolangTw/docs/01.4/">1.4 Go 開發工具</a></li>
<li><a href="/buildWebWithGolangTw/docs/01.5/">1.5 小結</a></li>
</ul></li>
<li><a href="/buildWebWithGolangTw/docs/02.0/">2.Go 語言基礎</a>

<ul>
<li><a href="/buildWebWithGolangTw/docs/02.1/">2.1 你好，Go</a></li>
<li><a href="/buildWebWithGolangTw/docs/02.2/">2.2 Go 基礎</a></li>
<li><a href="/buildWebWithGolangTw/docs/02.3/">2.3 流程和函式</a></li>
<li><a href="/buildWebWithGolangTw/docs/02.4/">2.4 struct</a></li>
<li><a href="/buildWebWithGolangTw/docs/02.5/">2.5 物件導向</a></li>
<li><a href="/buildWebWithGolangTw/docs/02.6/">2.6 interface</a></li>
<li><a href="/buildWebWithGolangTw/docs/02.7/">2.7 併發</a></li>
<li><a href="/buildWebWithGolangTw/docs/02.8/">2.8 小結</a></li>
</ul></li>
<li><a href="/buildWebWithGolangTw/docs/03.0/">3.Web 基礎</a>

<ul>
<li><a href="/buildWebWithGolangTw/docs/03.1/">3.1 web 工作方式</a></li>
<li><a href="/buildWebWithGolangTw/docs/03.2/">3.2 Go 建立一個簡單的 web 服務</a></li>
<li><a href="/buildWebWithGolangTw/docs/03.3/">3.3 Go 如何使得 web 工作</a></li>
<li><a href="/buildWebWithGolangTw/docs/03.4/">3.4 Go 的 http 套件詳解</a></li>
<li><a href="/buildWebWithGolangTw/docs/03.5/">3.5 小結</a></li>
</ul></li>
<li><a href="/buildWebWithGolangTw/docs/04.0/">4.表單</a>

<ul>
<li><a href="/buildWebWithGolangTw/docs/04.1/">4.1 處理表單的輸入</a></li>
<li><a href="/buildWebWithGolangTw/docs/04.2/">4.2 驗證表單的輸入</a></li>
<li><a href="/buildWebWithGolangTw/docs/04.3/">4.3 預防跨站指令碼</a></li>
<li><a href="/buildWebWithGolangTw/docs/04.4/">4.4 防止多次提交表單</a></li>
<li><a href="/buildWebWithGolangTw/docs/04.5/">4.5 處理檔案上傳</a></li>
<li><a href="/buildWebWithGolangTw/docs/04.6/">4.6 小結</a></li>
</ul></li>
<li><a href="/buildWebWithGolangTw/docs/05.0/">5.訪問資料庫</a>

<ul>
<li><a href="/buildWebWithGolangTw/docs/05.1/">5.1 database/sql 介面</a></li>
<li><a href="/buildWebWithGolangTw/docs/05.2/">5.2 使用 MySQL 資料庫</a></li>
<li><a href="/buildWebWithGolangTw/docs/05.3/">5.3 使用 SQLite 資料庫</a></li>
<li><a href="/buildWebWithGolangTw/docs/05.4/">5.4 使用 PostgreSQL 資料庫</a></li>
<li><a href="/buildWebWithGolangTw/docs/05.5/">5.5 使用 Beego orm 函式庫進行 ORM 開發</a></li>
<li><a href="/buildWebWithGolangTw/docs/05.6/">5.6 NOSQL 資料庫操作</a></li>
<li><a href="/buildWebWithGolangTw/docs/05.7/">5.7 小結</a></li>
</ul></li>
<li><a href="/buildWebWithGolangTw/docs/06.0/">6.session 和資料儲存</a>

<ul>
<li><a href="/buildWebWithGolangTw/docs/06.1/">6.1 session 和 cookie</a></li>
<li><a href="/buildWebWithGolangTw/docs/06.2/">6.2 Go 如何使用 session</a></li>
<li><a href="/buildWebWithGolangTw/docs/06.3/">6.3 session 儲存</a></li>
<li><a href="/buildWebWithGolangTw/docs/06.4/">6.4 預防 session 劫持</a></li>
<li><a href="/buildWebWithGolangTw/docs/06.5/">6.5 小結</a></li>
</ul></li>
<li><a href="/buildWebWithGolangTw/docs/07.0/">7.文字檔案處理</a>

<ul>
<li><a href="/buildWebWithGolangTw/docs/07.1/">7.1 XML 處理</a></li>
<li><a href="/buildWebWithGolangTw/docs/07.2/">7.2 JSON 處理</a></li>
<li><a href="/buildWebWithGolangTw/docs/07.3/">7.3 正則處理</a></li>
<li><a href="/buildWebWithGolangTw/docs/07.4/">7.4 範本處理</a></li>
<li><a href="/buildWebWithGolangTw/docs/07.5/">7.5 檔案操作</a></li>
<li><a href="/buildWebWithGolangTw/docs/07.6/">7.6 字串處理</a></li>
<li><a href="/buildWebWithGolangTw/docs/07.7/">7.7 小結</a></li>
</ul></li>
<li><a href="/buildWebWithGolangTw/docs/08.0/">8.Web 服務</a>

<ul>
<li><a href="/buildWebWithGolangTw/docs/08.1/">8.1 Socket 程式設計</a></li>
<li><a href="/buildWebWithGolangTw/docs/08.2/">8.2 WebSocket</a></li>
<li><a href="/buildWebWithGolangTw/docs/08.3/">8.3 REST</a></li>
<li><a href="/buildWebWithGolangTw/docs/08.4/">8.4 RPC</a></li>
<li><a href="/buildWebWithGolangTw/docs/08.5/">8.5 小結</a></li>
</ul></li>
<li><a href="/buildWebWithGolangTw/docs/09.0/">9.安全與加密</a>

<ul>
<li><a href="/buildWebWithGolangTw/docs/09.1/">9.1 預防 CSRF 攻擊</a></li>
<li><a href="/buildWebWithGolangTw/docs/09.2/">9.2 確保輸入過濾</a></li>
<li><a href="/buildWebWithGolangTw/docs/09.3/">9.3 避免 XSS 攻擊</a></li>
<li><a href="/buildWebWithGolangTw/docs/09.4/">9.4 避免 SQL 注入</a></li>
<li><a href="/buildWebWithGolangTw/docs/09.5/">9.5 儲存密碼</a></li>
<li><a href="/buildWebWithGolangTw/docs/09.6/">9.6 加密和解密資料</a></li>
<li><a href="/buildWebWithGolangTw/docs/09.7/">9.7 小結</a></li>
</ul></li>
<li><a href="/buildWebWithGolangTw/docs/10.0/">10.國際化和本地化</a>

<ul>
<li><a href="/buildWebWithGolangTw/docs/10.1/">10.1 設定預設地區</a></li>
<li><a href="/buildWebWithGolangTw/docs/10.2/">10.2 本地化資源</a></li>
<li><a href="/buildWebWithGolangTw/docs/10.3/">10.3 國際化站點</a></li>
<li><a href="/buildWebWithGolangTw/docs/10.4/">10.4 小結</a></li>
</ul></li>
<li><a href="/buildWebWithGolangTw/docs/11.0/">11.錯誤處理，除錯和測試</a>

<ul>
<li><a href="/buildWebWithGolangTw/docs/11.1/">11.1 錯誤處理</a></li>
<li><a href="/buildWebWithGolangTw/docs/11.2/">11.2 使用 GDB 除錯</a></li>
<li><a href="/buildWebWithGolangTw/docs/11.3/">11.3 Go 怎麼寫測試案例</a></li>
<li><a href="/buildWebWithGolangTw/docs/11.4/">11.4 小結</a></li>
</ul></li>
<li><a href="/buildWebWithGolangTw/docs/12.0/">12.部署與維護</a>

<ul>
<li><a href="/buildWebWithGolangTw/docs/12.1/">12.1 應用日誌</a></li>
<li><a href="/buildWebWithGolangTw/docs/12.2/">12.2 網站錯誤處理</a></li>
<li><a href="/buildWebWithGolangTw/docs/12.3/">12.3 應用部署</a></li>
<li><a href="/buildWebWithGolangTw/docs/12.4/">12.4 備份和還原</a></li>
<li><a href="/buildWebWithGolangTw/docs/12.5/">12.5 小結</a></li>
</ul></li>
<li><a href="/buildWebWithGolangTw/docs/13.0/">13.如何設計一個 Web 框架</a>

<ul>
<li><a href="/buildWebWithGolangTw/docs/13.1/">13.1 專案規劃</a></li>
<li><a href="/buildWebWithGolangTw/docs/13.2/">13.2 自訂路由器設計</a></li>
<li><a href="/buildWebWithGolangTw/docs/13.3/">13.3 controller 設計</a></li>
<li><a href="/buildWebWithGolangTw/docs/13.4/">13.4 日誌和配置設計</a></li>
<li><a href="/buildWebWithGolangTw/docs/13.5/">13.5 實現部落格的增刪改</a></li>
<li><a href="/buildWebWithGolangTw/docs/13.6/">13.6 小結</a></li>
</ul></li>
<li><a href="/buildWebWithGolangTw/docs/14.0/">14.擴充套件 Web 框架</a>

<ul>
<li><a href="/buildWebWithGolangTw/docs/14.1/">14.1 靜態檔案支援</a></li>
<li><a href="/buildWebWithGolangTw/docs/14.2/">14.2 Session 支援</a></li>
<li><a href="/buildWebWithGolangTw/docs/14.3/">14.3 表單支援</a></li>
<li><a href="/buildWebWithGolangTw/docs/14.4/">14.4 使用者認證</a></li>
<li><a href="/buildWebWithGolangTw/docs/14.5/">14.5 多語言支援</a></li>
<li><a href="/buildWebWithGolangTw/docs/14.6/">14.6 pprof 支援</a></li>
<li><a href="/buildWebWithGolangTw/docs/14.7/">14.7 小結</a></li>
</ul></li>
<li><a href="/buildWebWithGolangTw/docs/ref/">附錄 A 參考資料</a></li>
</ul>







</nav>


<script>
(function() {
  var menu = document.querySelector("aside.book-menu nav");
  addEventListener("beforeunload", function(event) {
    localStorage.setItem("menu.scrollTop", menu.scrollTop);
  });
  menu.scrollTop = localStorage.getItem("menu.scrollTop");
})();
</script>

    </aside>

    <div class="book-page">
      <header class="flex align-center justify-between book-header">
  <label for="menu-control">
    <img src="/buildWebWithGolangTw/svg/menu.svg" alt="Menu" />
  </label>
  <strong>07.4</strong>
</header>

      
<article class="markdown">

<h1 id="7-4-範本處理">7.4 範本處理</h1>

<h2 id="什麼是範本">什麼是範本</h2>

<p>你一定聽說過一種叫做 MVC 的設計模式，Model 處理資料，View 展現結果，Controller 控制使用者的請求，至於 View 層的處理，在很多動態語言裡面都是透過在靜態 HTML 中插入動態語言產生的資料，例如 JSP 中透過插入<code>&lt;%=....=%&gt;</code>，PHP 中透過插入<code>&lt;?php.....?&gt;</code>來實現的。</p>

<p>透過下面這個圖可以說明範本的機制</p>

<p><img src="images/7.4.template.png" alt="" /></p>

<p>圖 7.1 範本機制圖</p>

<p>Web 應用反饋給客戶端的資訊中的大部分內容是靜態的，不變的，而另外少部分是根據使用者的請求來動態產生的，例如要顯示使用者的訪問記錄列表。使用者之間只有記錄資料是不同的，而列表的樣式則是固定的，此時採用範本可以複用很多靜態程式碼。</p>

<h2 id="go-範本使用">Go 範本使用</h2>

<p>在 Go 語言中，我們使用 <code>template</code> 套件來進行範本處理，使用類似<code>Parse</code>、<code>ParseFile</code>、<code>Execute</code>等方法從檔案或者字串載入範本，然後執行類似上面圖片展示的範本的 merge 操作。請看下面的例子：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Go" data-lang="Go"><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">handler</span>(<span style="color:#a6e22e">w</span> <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">ResponseWriter</span>, <span style="color:#a6e22e">r</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">Request</span>) {
	<span style="color:#a6e22e">t</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">template</span>.<span style="color:#a6e22e">New</span>(<span style="color:#e6db74">&#34;some template&#34;</span>) <span style="color:#75715e">//建立一個範本
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">t</span>, <span style="color:#a6e22e">_</span> = <span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">ParseFiles</span>(<span style="color:#e6db74">&#34;tmpl/welcome.html&#34;</span>)  <span style="color:#75715e">//解析範本檔案
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">user</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">GetUser</span>() <span style="color:#75715e">//取得當前使用者資訊
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">Execute</span>(<span style="color:#a6e22e">w</span>, <span style="color:#a6e22e">user</span>)  <span style="color:#75715e">//執行範本的 merger 操作
</span><span style="color:#75715e"></span>}</code></pre></div>
<p>透過上面的例子我們可以看到 Go 語言的範本操作非常的簡單方便，和其他語言的範本處理類似，都是先取得資料，然後渲染資料。</p>

<p>為了示範和測試程式碼的方便，我們在接下來的例子中採用如下格式的程式碼</p>

<ul>
<li>使用 Parse 代替 ParseFiles，因為 Parse 可以直接測試一個字串，而不需要額外的檔案</li>
<li>不使用 handler 來寫示範程式碼，而是每個測試一個 main，方便測試</li>
<li>使用<code>os.Stdout</code>代替<code>http.ResponseWriter</code>，因為<code>os.Stdout</code>實現了<code>io.Writer</code>介面</li>
</ul>

<h2 id="範本中如何插入資料">範本中如何插入資料？</h2>

<p>上面我們示範了如何解析並渲染範本，接下來讓我們來更加詳細的了解如何把資料渲染出來。一個範本都是應用在一個 Go 的物件之上，Go 物件的欄位如何插入到範本中呢？</p>

<h3 id="欄位操作">欄位操作</h3>

<p>Go 語言的範本透過 <code>{{}}</code> 來包含需要在渲染時被替換的欄位，<code>{{.}}</code>表示當前的物件，這和 Java 或者 C++中的 this 類似，如果要訪問當前物件的欄位透過<code>{{.FieldName}}</code>，但是需要注意一點：這個欄位必須是匯出的(欄位首字母必須是大寫的)，否則在渲染的時候就會報錯，請看下面的這個例子：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Go" data-lang="Go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>

<span style="color:#f92672">import</span> (
	<span style="color:#e6db74">&#34;html/template&#34;</span>
	<span style="color:#e6db74">&#34;os&#34;</span>
)

<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Person</span> <span style="color:#66d9ef">struct</span> {
	<span style="color:#a6e22e">UserName</span> <span style="color:#66d9ef">string</span>
}

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
	<span style="color:#a6e22e">t</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">template</span>.<span style="color:#a6e22e">New</span>(<span style="color:#e6db74">&#34;fieldname example&#34;</span>)
	<span style="color:#a6e22e">t</span>, <span style="color:#a6e22e">_</span> = <span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">Parse</span>(<span style="color:#e6db74">&#34;hello {{.UserName}}!&#34;</span>)
	<span style="color:#a6e22e">p</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">Person</span>{<span style="color:#a6e22e">UserName</span>: <span style="color:#e6db74">&#34;Astaxie&#34;</span>}
	<span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">Execute</span>(<span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Stdout</span>, <span style="color:#a6e22e">p</span>)
}</code></pre></div>
<p>上面的程式碼我們可以正確的輸出<code>hello Astaxie</code>，但是如果我們稍微修改一下程式碼，在範本中含有了未匯出的欄位，那麼就會報錯</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Go" data-lang="Go"><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Person</span> <span style="color:#66d9ef">struct</span> {
	<span style="color:#a6e22e">UserName</span> <span style="color:#66d9ef">string</span>
	<span style="color:#a6e22e">email</span>	<span style="color:#66d9ef">string</span>  <span style="color:#75715e">//未匯出的欄位，首字母是小寫的
</span><span style="color:#75715e"></span>}

<span style="color:#a6e22e">t</span>, <span style="color:#a6e22e">_</span> = <span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">Parse</span>(<span style="color:#e6db74">&#34;hello {{.UserName}}! {{.email}}&#34;</span>)</code></pre></div>
<p>上面的程式碼就會報錯，因為我們呼叫了一個未匯出的欄位，但是如果我們呼叫了一個不存在的欄位是不會報錯的，而是輸出為空。</p>

<p>如果範本中輸出<code>{{.}}</code>，這個一般應用於字串物件，預設會呼叫 fmt 套件輸出字串的內容。</p>

<h3 id="輸出巢狀欄位內容">輸出巢狀欄位內容</h3>

<p>上面我們例子展示了如何針對一個物件的欄位輸出，那麼如果欄位裡面還有物件，如何來迴圈的輸出這些內容呢？我們可以使用<code>{{with …}}…{{end}}</code>和<code>{{range …}}{{end}}</code>來進行資料的輸出。</p>

<ul>
<li>{{range}} 這個和 Go 語法裡面的 range 類似，迴圈操作資料</li>
<li>{{with}}操作是指當前物件的值，類似上下文的概念</li>
</ul>

<p>詳細的使用請看下面的例子：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Go" data-lang="Go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>

<span style="color:#f92672">import</span> (
	<span style="color:#e6db74">&#34;html/template&#34;</span>
	<span style="color:#e6db74">&#34;os&#34;</span>
)

<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Friend</span> <span style="color:#66d9ef">struct</span> {
	<span style="color:#a6e22e">Fname</span> <span style="color:#66d9ef">string</span>
}

<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Person</span> <span style="color:#66d9ef">struct</span> {
	<span style="color:#a6e22e">UserName</span> <span style="color:#66d9ef">string</span>
	<span style="color:#a6e22e">Emails</span>   []<span style="color:#66d9ef">string</span>
	<span style="color:#a6e22e">Friends</span>  []<span style="color:#f92672">*</span><span style="color:#a6e22e">Friend</span>
}

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
	<span style="color:#a6e22e">f1</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">Friend</span>{<span style="color:#a6e22e">Fname</span>: <span style="color:#e6db74">&#34;minux.ma&#34;</span>}
	<span style="color:#a6e22e">f2</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">Friend</span>{<span style="color:#a6e22e">Fname</span>: <span style="color:#e6db74">&#34;xushiwei&#34;</span>}
	<span style="color:#a6e22e">t</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">template</span>.<span style="color:#a6e22e">New</span>(<span style="color:#e6db74">&#34;fieldname example&#34;</span>)
	<span style="color:#a6e22e">t</span>, <span style="color:#a6e22e">_</span> = <span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">Parse</span>(<span style="color:#e6db74">`hello </span><span style="color:#75715e">{{</span><span style="color:#a6e22e">.UserName</span><span style="color:#75715e">}}</span><span style="color:#e6db74">!
</span><span style="color:#e6db74">			</span><span style="color:#75715e">{{</span><span style="color:#66d9ef">range</span> <span style="color:#a6e22e">.Emails</span><span style="color:#75715e">}}</span><span style="color:#e6db74">
</span><span style="color:#e6db74">				an email </span><span style="color:#75715e">{{</span><span style="color:#a6e22e">.</span><span style="color:#75715e">}}</span><span style="color:#e6db74">
</span><span style="color:#e6db74">			</span><span style="color:#75715e">{{</span><span style="color:#66d9ef">end</span><span style="color:#75715e">}}</span><span style="color:#e6db74">
</span><span style="color:#e6db74">			</span><span style="color:#75715e">{{</span><span style="color:#66d9ef">with</span> <span style="color:#a6e22e">.Friends</span><span style="color:#75715e">}}</span><span style="color:#e6db74">
</span><span style="color:#e6db74">			</span><span style="color:#75715e">{{</span><span style="color:#66d9ef">range</span> <span style="color:#a6e22e">.</span><span style="color:#75715e">}}</span><span style="color:#e6db74">
</span><span style="color:#e6db74">				my friend name is </span><span style="color:#75715e">{{</span><span style="color:#a6e22e">.Fname</span><span style="color:#75715e">}}</span><span style="color:#e6db74">
</span><span style="color:#e6db74">			</span><span style="color:#75715e">{{</span><span style="color:#66d9ef">end</span><span style="color:#75715e">}}</span><span style="color:#e6db74">
</span><span style="color:#e6db74">			</span><span style="color:#75715e">{{</span><span style="color:#66d9ef">end</span><span style="color:#75715e">}}</span><span style="color:#e6db74">
</span><span style="color:#e6db74">			`</span>)
	<span style="color:#a6e22e">p</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">Person</span>{<span style="color:#a6e22e">UserName</span>: <span style="color:#e6db74">&#34;Astaxie&#34;</span>,
		<span style="color:#a6e22e">Emails</span>:  []<span style="color:#66d9ef">string</span>{<span style="color:#e6db74">&#34;astaxie@beego.me&#34;</span>, <span style="color:#e6db74">&#34;astaxie@gmail.com&#34;</span>},
		<span style="color:#a6e22e">Friends</span>: []<span style="color:#f92672">*</span><span style="color:#a6e22e">Friend</span>{<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">f1</span>, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">f2</span>}}
	<span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">Execute</span>(<span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Stdout</span>, <span style="color:#a6e22e">p</span>)
}</code></pre></div>
<h3 id="條件處理">條件處理</h3>

<p>在 Go 範本裡面如果需要進行條件判斷，那麼我們可以使用和 Go 語言的<code>if-else</code>語法類似的方式來處理，如果 pipeline 為空，那麼 if 就認為是 false，下面的例子展示了如何使用<code>if-else</code>語法：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Go" data-lang="Go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>

<span style="color:#f92672">import</span> (
	<span style="color:#e6db74">&#34;os&#34;</span>
	<span style="color:#e6db74">&#34;text/template&#34;</span>
)

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
	<span style="color:#a6e22e">tEmpty</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">template</span>.<span style="color:#a6e22e">New</span>(<span style="color:#e6db74">&#34;template test&#34;</span>)
	<span style="color:#a6e22e">tEmpty</span> = <span style="color:#a6e22e">template</span>.<span style="color:#a6e22e">Must</span>(<span style="color:#a6e22e">tEmpty</span>.<span style="color:#a6e22e">Parse</span>(<span style="color:#e6db74">&#34;空 pipeline if demo: {{if ``}} 不會輸出. {{end}}\n&#34;</span>))
	<span style="color:#a6e22e">tEmpty</span>.<span style="color:#a6e22e">Execute</span>(<span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Stdout</span>, <span style="color:#66d9ef">nil</span>)

	<span style="color:#a6e22e">tWithValue</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">template</span>.<span style="color:#a6e22e">New</span>(<span style="color:#e6db74">&#34;template test&#34;</span>)
	<span style="color:#a6e22e">tWithValue</span> = <span style="color:#a6e22e">template</span>.<span style="color:#a6e22e">Must</span>(<span style="color:#a6e22e">tWithValue</span>.<span style="color:#a6e22e">Parse</span>(<span style="color:#e6db74">&#34;不為空的 pipeline if demo: {{if `anything`}} 我有內容，我會輸出. {{end}}\n&#34;</span>))
	<span style="color:#a6e22e">tWithValue</span>.<span style="color:#a6e22e">Execute</span>(<span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Stdout</span>, <span style="color:#66d9ef">nil</span>)

	<span style="color:#a6e22e">tIfElse</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">template</span>.<span style="color:#a6e22e">New</span>(<span style="color:#e6db74">&#34;template test&#34;</span>)
	<span style="color:#a6e22e">tIfElse</span> = <span style="color:#a6e22e">template</span>.<span style="color:#a6e22e">Must</span>(<span style="color:#a6e22e">tIfElse</span>.<span style="color:#a6e22e">Parse</span>(<span style="color:#e6db74">&#34;if-else demo: {{if `anything`}} if 部分 {{else}} else 部分.{{end}}\n&#34;</span>))
	<span style="color:#a6e22e">tIfElse</span>.<span style="color:#a6e22e">Execute</span>(<span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Stdout</span>, <span style="color:#66d9ef">nil</span>)
}</code></pre></div>
<p>透過上面的示範程式碼我們知道<code>if-else</code>語法相當的簡單，在使用過程中很容易整合到我們的範本程式碼中。</p>

<blockquote>
<p>注意：if 裡面無法使用條件判斷，例如.Mail==&ldquo;astaxie@gmail.com&rdquo;，這樣的判斷是不正確的，if 裡面只能是 bool 值</p>
</blockquote>

<h3 id="pipelines">pipelines</h3>

<p>Unix 使用者已經很熟悉什麼是 <code>pipe</code> 了，<code>ls | grep &quot;beego&quot;</code>類似這樣的語法你是不是經常使用，過濾當前目錄下面的檔案，顯示含有&rdquo;beego&rdquo;的資料，表達的意思就是前面的輸出可以當做後面的輸入，最後顯示我們想要的資料，而 Go 語言範本最強大的一點就是支援 pipe 資料，在 Go 語言裡面任何 <code>{{}}</code> 裡面的都是 pipelines 資料，例如我們上面輸出的 email 裡面如果還有一些可能引起 XSS 注入的，那麼我們如何來進行轉化呢？</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Go" data-lang="Go">{{. | <span style="color:#a6e22e">html</span>}}</code></pre></div>
<p>在 email 輸出的地方我們可以採用如上方式可以把輸出全部轉化 html 的實體，上面的這種方式和我們平常寫 Unix 的方式是不是一模一樣，操作起來相當的簡便，呼叫其他的函式也是類似的方式。</p>

<h3 id="範本變數">範本變數</h3>

<p>有時候，我們在範本使用過程中需要定義一些區域性變數，我們可以在一些操作中宣告區域性變數，例如 <code>with</code><code>range</code><code>if</code> 過程中宣告區域性變數，這個變數的作用域是 <code>{{end}}</code> 之前，Go 語言透過宣告的區域性變數格式如下所示：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Go" data-lang="Go"><span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">variable</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">pipeline</span></code></pre></div>
<p>詳細的例子看下面的：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Go" data-lang="Go">{{<span style="color:#a6e22e">with</span> <span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">x</span> <span style="color:#f92672">:=</span> <span style="color:#e6db74">&#34;output&#34;</span> | <span style="color:#a6e22e">printf</span> <span style="color:#e6db74">&#34;%q&#34;</span>}}{{<span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">x</span>}}{{<span style="color:#a6e22e">end</span>}}
{{<span style="color:#a6e22e">with</span> <span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">x</span> <span style="color:#f92672">:=</span> <span style="color:#e6db74">&#34;output&#34;</span>}}{{<span style="color:#a6e22e">printf</span> <span style="color:#e6db74">&#34;%q&#34;</span> <span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">x</span>}}{{<span style="color:#a6e22e">end</span>}}
{{<span style="color:#a6e22e">with</span> <span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">x</span> <span style="color:#f92672">:=</span> <span style="color:#e6db74">&#34;output&#34;</span>}}{{<span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">x</span> | <span style="color:#a6e22e">printf</span> <span style="color:#e6db74">&#34;%q&#34;</span>}}{{<span style="color:#a6e22e">end</span>}}</code></pre></div>
<h3 id="範本函式">範本函式</h3>

<p>範本在輸出物件的欄位值時，採用了 <code>fmt</code> 套件把物件轉化成了字串。但是有時候我們的需求可能不是這樣的，例如有時候我們為了防止垃圾郵件傳送者透過採集網頁的方式來發送給我們的郵箱資訊，我們希望把 <code>@</code> 替換成 <code>at</code> 例如：<code>astaxie at beego.me</code>，如果要實現這樣的功能，我們就需要自訂函式來做這個功能。</p>

<p>每一個範本函式都有一個唯一值的名字，然後與一個 Go 函式關聯，透過如下的方式來關聯</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Go" data-lang="Go"><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">FuncMap</span> <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{}</code></pre></div>
<p>例如，如果我們想要的 email 函式的範本函式名是<code>emailDeal</code>，它關聯的 Go 函式名稱是<code>EmailDealWith</code>，那麼我們可以透過下面的方式來註冊這個函式</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Go" data-lang="Go"><span style="color:#a6e22e">t</span> = <span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">Funcs</span>(<span style="color:#a6e22e">template</span>.<span style="color:#a6e22e">FuncMap</span>{<span style="color:#e6db74">&#34;emailDeal&#34;</span>: <span style="color:#a6e22e">EmailDealWith</span>})</code></pre></div>
<p><code>EmailDealWith</code>這個函式的參數和回傳值定義如下：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Go" data-lang="Go"><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">EmailDealWith</span>(<span style="color:#a6e22e">args</span> <span style="color:#960050;background-color:#1e0010">…</span><span style="color:#66d9ef">interface</span>{}) <span style="color:#66d9ef">string</span></code></pre></div>
<p>我們來看下面的實現例子：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Go" data-lang="Go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>

<span style="color:#f92672">import</span> (
	<span style="color:#e6db74">&#34;fmt&#34;</span>
	<span style="color:#e6db74">&#34;html/template&#34;</span>
	<span style="color:#e6db74">&#34;os&#34;</span>
	<span style="color:#e6db74">&#34;strings&#34;</span>
)

<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Friend</span> <span style="color:#66d9ef">struct</span> {
	<span style="color:#a6e22e">Fname</span> <span style="color:#66d9ef">string</span>
}

<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Person</span> <span style="color:#66d9ef">struct</span> {
	<span style="color:#a6e22e">UserName</span> <span style="color:#66d9ef">string</span>
	<span style="color:#a6e22e">Emails</span>   []<span style="color:#66d9ef">string</span>
	<span style="color:#a6e22e">Friends</span>  []<span style="color:#f92672">*</span><span style="color:#a6e22e">Friend</span>
}

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">EmailDealWith</span>(<span style="color:#a6e22e">args</span> <span style="color:#f92672">...</span><span style="color:#66d9ef">interface</span>{}) <span style="color:#66d9ef">string</span> {
	<span style="color:#a6e22e">ok</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">false</span>
	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">s</span> <span style="color:#66d9ef">string</span>
	<span style="color:#66d9ef">if</span> len(<span style="color:#a6e22e">args</span>) <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span> {
		<span style="color:#a6e22e">s</span>, <span style="color:#a6e22e">ok</span> = <span style="color:#a6e22e">args</span>[<span style="color:#ae81ff">0</span>].(<span style="color:#66d9ef">string</span>)
	}
	<span style="color:#66d9ef">if</span> !<span style="color:#a6e22e">ok</span> {
		<span style="color:#a6e22e">s</span> = <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Sprint</span>(<span style="color:#a6e22e">args</span><span style="color:#f92672">...</span>)
	}
	<span style="color:#75715e">// find the @ symbol
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">substrs</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">strings</span>.<span style="color:#a6e22e">Split</span>(<span style="color:#a6e22e">s</span>, <span style="color:#e6db74">&#34;@&#34;</span>)
	<span style="color:#66d9ef">if</span> len(<span style="color:#a6e22e">substrs</span>) <span style="color:#f92672">!=</span> <span style="color:#ae81ff">2</span> {
		<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">s</span>
	}
	<span style="color:#75715e">// replace the @ by &#34; at &#34;
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">return</span> (<span style="color:#a6e22e">substrs</span>[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; at &#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">substrs</span>[<span style="color:#ae81ff">1</span>])
}

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
	<span style="color:#a6e22e">f1</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">Friend</span>{<span style="color:#a6e22e">Fname</span>: <span style="color:#e6db74">&#34;minux.ma&#34;</span>}
	<span style="color:#a6e22e">f2</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">Friend</span>{<span style="color:#a6e22e">Fname</span>: <span style="color:#e6db74">&#34;xushiwei&#34;</span>}
	<span style="color:#a6e22e">t</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">template</span>.<span style="color:#a6e22e">New</span>(<span style="color:#e6db74">&#34;fieldname example&#34;</span>)
	<span style="color:#a6e22e">t</span> = <span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">Funcs</span>(<span style="color:#a6e22e">template</span>.<span style="color:#a6e22e">FuncMap</span>{<span style="color:#e6db74">&#34;emailDeal&#34;</span>: <span style="color:#a6e22e">EmailDealWith</span>})
	<span style="color:#a6e22e">t</span>, <span style="color:#a6e22e">_</span> = <span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">Parse</span>(<span style="color:#e6db74">`hello </span><span style="color:#75715e">{{</span><span style="color:#a6e22e">.UserName</span><span style="color:#75715e">}}</span><span style="color:#e6db74">!
</span><span style="color:#e6db74">				</span><span style="color:#75715e">{{</span><span style="color:#66d9ef">range</span> <span style="color:#a6e22e">.Emails</span><span style="color:#75715e">}}</span><span style="color:#e6db74">
</span><span style="color:#e6db74">					an emails </span><span style="color:#75715e">{{</span><span style="color:#a6e22e">.</span><span style="color:#f92672">|</span><span style="color:#a6e22e">emailDeal</span><span style="color:#75715e">}}</span><span style="color:#e6db74">
</span><span style="color:#e6db74">				</span><span style="color:#75715e">{{</span><span style="color:#66d9ef">end</span><span style="color:#75715e">}}</span><span style="color:#e6db74">
</span><span style="color:#e6db74">				</span><span style="color:#75715e">{{</span><span style="color:#66d9ef">with</span> <span style="color:#a6e22e">.Friends</span><span style="color:#75715e">}}</span><span style="color:#e6db74">
</span><span style="color:#e6db74">				</span><span style="color:#75715e">{{</span><span style="color:#66d9ef">range</span> <span style="color:#a6e22e">.</span><span style="color:#75715e">}}</span><span style="color:#e6db74">
</span><span style="color:#e6db74">					my friend name is </span><span style="color:#75715e">{{</span><span style="color:#a6e22e">.Fname</span><span style="color:#75715e">}}</span><span style="color:#e6db74">
</span><span style="color:#e6db74">				</span><span style="color:#75715e">{{</span><span style="color:#66d9ef">end</span><span style="color:#75715e">}}</span><span style="color:#e6db74">
</span><span style="color:#e6db74">				</span><span style="color:#75715e">{{</span><span style="color:#66d9ef">end</span><span style="color:#75715e">}}</span><span style="color:#e6db74">
</span><span style="color:#e6db74">				`</span>)
	<span style="color:#a6e22e">p</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">Person</span>{<span style="color:#a6e22e">UserName</span>: <span style="color:#e6db74">&#34;Astaxie&#34;</span>,
		<span style="color:#a6e22e">Emails</span>:  []<span style="color:#66d9ef">string</span>{<span style="color:#e6db74">&#34;astaxie@beego.me&#34;</span>, <span style="color:#e6db74">&#34;astaxie@gmail.com&#34;</span>},
		<span style="color:#a6e22e">Friends</span>: []<span style="color:#f92672">*</span><span style="color:#a6e22e">Friend</span>{<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">f1</span>, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">f2</span>}}
	<span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">Execute</span>(<span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Stdout</span>, <span style="color:#a6e22e">p</span>)
}</code></pre></div>
<p>上面示範了如何自訂函式，其實，在範本套件內部已經有內建的實現函式，下面程式碼擷取自範本套件裡面</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Go" data-lang="Go"><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">builtins</span> = <span style="color:#a6e22e">FuncMap</span>{
	<span style="color:#e6db74">&#34;and&#34;</span>:      <span style="color:#a6e22e">and</span>,
	<span style="color:#e6db74">&#34;call&#34;</span>:     <span style="color:#a6e22e">call</span>,
	<span style="color:#e6db74">&#34;html&#34;</span>:     <span style="color:#a6e22e">HTMLEscaper</span>,
	<span style="color:#e6db74">&#34;index&#34;</span>:    <span style="color:#a6e22e">index</span>,
	<span style="color:#e6db74">&#34;js&#34;</span>:       <span style="color:#a6e22e">JSEscaper</span>,
	<span style="color:#e6db74">&#34;len&#34;</span>:      <span style="color:#a6e22e">length</span>,
	<span style="color:#e6db74">&#34;not&#34;</span>:      <span style="color:#a6e22e">not</span>,
	<span style="color:#e6db74">&#34;or&#34;</span>:       <span style="color:#a6e22e">or</span>,
	<span style="color:#e6db74">&#34;print&#34;</span>:    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Sprint</span>,
	<span style="color:#e6db74">&#34;printf&#34;</span>:   <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Sprintf</span>,
	<span style="color:#e6db74">&#34;println&#34;</span>:  <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Sprintln</span>,
	<span style="color:#e6db74">&#34;urlquery&#34;</span>: <span style="color:#a6e22e">URLQueryEscaper</span>,
}</code></pre></div>
<h2 id="must-操作">Must 操作</h2>

<p>範本套件裡面有一個函式<code>Must</code>，它的作用是檢測範本是否正確，例如大括號是否匹配，註釋是否正確的關閉，變數是否正確的書寫。接下來我們示範一個例子，用 Must 來判斷範本是否正確：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Go" data-lang="Go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>

<span style="color:#f92672">import</span> (
	<span style="color:#e6db74">&#34;fmt&#34;</span>
	<span style="color:#e6db74">&#34;text/template&#34;</span>
)

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
	<span style="color:#a6e22e">tOk</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">template</span>.<span style="color:#a6e22e">New</span>(<span style="color:#e6db74">&#34;first&#34;</span>)
	<span style="color:#a6e22e">template</span>.<span style="color:#a6e22e">Must</span>(<span style="color:#a6e22e">tOk</span>.<span style="color:#a6e22e">Parse</span>(<span style="color:#e6db74">&#34; some static text /* and a comment */&#34;</span>))
	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;The first one parsed OK.&#34;</span>)

	<span style="color:#a6e22e">template</span>.<span style="color:#a6e22e">Must</span>(<span style="color:#a6e22e">template</span>.<span style="color:#a6e22e">New</span>(<span style="color:#e6db74">&#34;second&#34;</span>).<span style="color:#a6e22e">Parse</span>(<span style="color:#e6db74">&#34;some static text {{ .Name }}&#34;</span>))
	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;The second one parsed OK.&#34;</span>)

	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;The next one ought to fail.&#34;</span>)
	<span style="color:#a6e22e">tErr</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">template</span>.<span style="color:#a6e22e">New</span>(<span style="color:#e6db74">&#34;check parse error with Must&#34;</span>)
	<span style="color:#a6e22e">template</span>.<span style="color:#a6e22e">Must</span>(<span style="color:#a6e22e">tErr</span>.<span style="color:#a6e22e">Parse</span>(<span style="color:#e6db74">&#34; some static text {{ .Name }&#34;</span>))
}</code></pre></div>
<p>將輸出如下內容</p>

<pre><code>
The first one parsed OK.
The second one parsed OK.
The next one ought to fail.
panic: template: check parse error with Must:1: unexpected &quot;}&quot; in command
</code></pre>

<h2 id="巢狀範本">巢狀範本</h2>

<p>我們平常開發 Web 應用的時候，經常會遇到一些範本有些部分是固定不變的，然後可以抽取出來作為一個獨立的部分，例如一個部落格的頭部和尾部是不變的，而唯一改變的是中間的內容部分。所以我們可以定義成<code>header</code>、<code>content</code>、<code>footer</code>三個部分。Go 語言中透過如下的語法來宣告</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Go" data-lang="Go">{{<span style="color:#a6e22e">define</span> <span style="color:#e6db74">&#34;子範本名稱&#34;</span>}}<span style="color:#a6e22e">內容</span>{{<span style="color:#a6e22e">end</span>}}</code></pre></div>
<p>透過如下方式來呼叫：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Go" data-lang="Go">{{<span style="color:#a6e22e">template</span> <span style="color:#e6db74">&#34;子範本名稱&#34;</span>}}</code></pre></div>
<p>接下來我們示範如何使用巢狀範本，我們定義三個檔案，<code>header.tmpl</code>、<code>content.tmpl</code>、<code>footer.tmpl</code>檔案，裡面的內容如下</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">//header.tmpl
{{define &#34;header&#34;}}
&lt;<span style="color:#f92672">html</span>&gt;
&lt;<span style="color:#f92672">head</span>&gt;
	&lt;<span style="color:#f92672">title</span>&gt;示範資訊&lt;/<span style="color:#f92672">title</span>&gt;
&lt;/<span style="color:#f92672">head</span>&gt;
&lt;<span style="color:#f92672">body</span>&gt;
{{end}}

//content.tmpl
{{define &#34;content&#34;}}
{{template &#34;header&#34;}}
&lt;<span style="color:#f92672">h1</span>&gt;示範巢狀&lt;/<span style="color:#f92672">h1</span>&gt;
&lt;<span style="color:#f92672">ul</span>&gt;
	&lt;<span style="color:#f92672">li</span>&gt;巢狀使用 define 定義子範本&lt;/<span style="color:#f92672">li</span>&gt;
	&lt;<span style="color:#f92672">li</span>&gt;呼叫使用 template&lt;/<span style="color:#f92672">li</span>&gt;
&lt;/<span style="color:#f92672">ul</span>&gt;
{{template &#34;footer&#34;}}
{{end}}

//footer.tmpl
{{define &#34;footer&#34;}}
&lt;/<span style="color:#f92672">body</span>&gt;
&lt;/<span style="color:#f92672">html</span>&gt;
{{end}}</code></pre></div>
<p>示範程式碼如下：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Go" data-lang="Go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>

<span style="color:#f92672">import</span> (
	<span style="color:#e6db74">&#34;fmt&#34;</span>
	<span style="color:#e6db74">&#34;os&#34;</span>
	<span style="color:#e6db74">&#34;text/template&#34;</span>
)

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
	<span style="color:#a6e22e">s1</span>, <span style="color:#a6e22e">_</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">template</span>.<span style="color:#a6e22e">ParseFiles</span>(<span style="color:#e6db74">&#34;header.tmpl&#34;</span>, <span style="color:#e6db74">&#34;content.tmpl&#34;</span>, <span style="color:#e6db74">&#34;footer.tmpl&#34;</span>)
	<span style="color:#a6e22e">s1</span>.<span style="color:#a6e22e">ExecuteTemplate</span>(<span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Stdout</span>, <span style="color:#e6db74">&#34;header&#34;</span>, <span style="color:#66d9ef">nil</span>)
	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>()
	<span style="color:#a6e22e">s1</span>.<span style="color:#a6e22e">ExecuteTemplate</span>(<span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Stdout</span>, <span style="color:#e6db74">&#34;content&#34;</span>, <span style="color:#66d9ef">nil</span>)
	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>()
	<span style="color:#a6e22e">s1</span>.<span style="color:#a6e22e">ExecuteTemplate</span>(<span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Stdout</span>, <span style="color:#e6db74">&#34;footer&#34;</span>, <span style="color:#66d9ef">nil</span>)
	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>()
	<span style="color:#a6e22e">s1</span>.<span style="color:#a6e22e">Execute</span>(<span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Stdout</span>, <span style="color:#66d9ef">nil</span>)
}</code></pre></div>
<p>透過上面的例子我們可以看到透過<code>template.ParseFiles</code>把所有的巢狀範本全部解析到範本裡面，其實每一個定義的 {{define}} 都是一個獨立的範本，他們相互獨立，是並行存在的關係，內部其實儲存的是類似 map 的一種關係(key 是範本的名稱，value 是範本的內容)，然後我們透過 <code>ExecuteTemplate</code> 來執行相應的子範本內容，我們可以看到 header、footer 都是相對獨立的，都能輸出內容，content 中因為嵌套了 header 和 footer 的內容，就會同時輸出三個的內容。但是當我們執行<code>s1.Execute</code>，沒有任何的輸出，因為在預設的情況下沒有預設的子範本，所以不會輸出任何的東西。</p>

<blockquote>
<p>同一個集合類別的範本是互相知曉的，如果同一範本被多個集合使用，則它需要在多個集合中分別解析</p>
</blockquote>

<h2 id="總結">總結</h2>

<p>透過上面對範本的詳細介紹，我們了解了如何把動態資料與範本融合：如何輸出迴圈資料、如何自訂函式、如何巢狀範本等等。透過範本技術的應用，我們可以完成 MVC 模式中 V 的處理，接下來的章節我們將介紹如何來處理 M 和 C。</p>

<h2 id="links">links</h2>

<ul>
<li><a href="docs/preface">目錄</a></li>
<li>上一節: <a href="docs/07.3">正則處理</a></li>
<li>下一節: <a href="docs/07.5">檔案操作</a></li>
</ul>
</article>

      
<div class="book-footer justify-between">
  
  <div>
    
    <a href="/commit/fda25aafea9413c8ec77f5df29d5f6bb5f7dc3a6" title='Last modified Sep 21, 2019 by Jiuxiao' target="_blank" rel="noopener">
      <img src="/buildWebWithGolangTw/svg/calendar.svg" alt="Changed" /> Sep 21, 2019
    </a>
  </div>
  
  
</div>


      
    </div>

    
  

  <aside class="book-toc level-3 fixed">
    <nav id="TableOfContents">
<ul>
<li><a href="#7-4-範本處理">7.4 範本處理</a>
<ul>
<li><a href="#什麼是範本">什麼是範本</a></li>
<li><a href="#go-範本使用">Go 範本使用</a></li>
<li><a href="#範本中如何插入資料">範本中如何插入資料？</a>
<ul>
<li><a href="#欄位操作">欄位操作</a></li>
<li><a href="#輸出巢狀欄位內容">輸出巢狀欄位內容</a></li>
<li><a href="#條件處理">條件處理</a></li>
<li><a href="#pipelines">pipelines</a></li>
<li><a href="#範本變數">範本變數</a></li>
<li><a href="#範本函式">範本函式</a></li>
</ul></li>
<li><a href="#must-操作">Must 操作</a></li>
<li><a href="#巢狀範本">巢狀範本</a></li>
<li><a href="#總結">總結</a></li>
<li><a href="#links">links</a></li>
</ul></li>
</ul>
</nav>
  </aside>



  </main>

  
  
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-148025936-2', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

</body>

</html>
