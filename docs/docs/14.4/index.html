<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>14.4 | 使用 Golang 打造 Web 應用程式</title>


<link rel="stylesheet" href="/buildWebWithGolangTw/book.min.89885fa0429ec73067282f26fc0c6d38cfc617a443ec4e835d47b821c52c6e92.css" integrity="sha256-iYhfoEKexzBnKC8m/AxtOM/GF6RD7E6DXUe4IcUsbpI=">


<script defer src="/buildWebWithGolangTw/search.min.4762838110f5450a8a33fcbe56c7ce734d09867f3e9ab5c1e6f7bbec99b65c68.js" integrity="sha256-R2KDgRD1RQqKM/y&#43;VsfOc00Jhn8&#43;mrXB5ve77Jm2XGg="></script>



<link rel="icon" href="/buildWebWithGolangTw/favicon.png" type="image/x-icon">

<base href="https://ezzdoc.com/buildWebWithGolangTw/">


<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

  
</head>

<body>
  <input type="checkbox" class="hidden" id="menu-control" />
  <main class="flex container">

    <aside class="book-menu fixed">
      <nav>
<h2 class="book-brand">
  <a href="https://ezzdoc.com/buildWebWithGolangTw/"><span>使用 Golang 打造 Web 應用程式</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" placeholder="Search" id="book-search-input" maxlength="64" readonly />
  <div class="book-search-spinner spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>





    
  
  
  

  <style>
  nav ul a[href$="\2f buildWebWithGolangTw\2f docs\2f 14.4\2f "] {
      color: #004ed0;
  }
  </style>

<ul>
<li><a href="/buildWebWithGolangTw/docs/preface/">目錄</a></li>
<li><a href="/buildWebWithGolangTw/docs/01.0/">1.Go 環境配置</a>

<ul>
<li><a href="/buildWebWithGolangTw/docs/01.1/">1.1 安裝 Go</a></li>
<li><a href="/buildWebWithGolangTw/docs/01.2/">1.2 GOPATH 與工作空間</a></li>
<li><a href="/buildWebWithGolangTw/docs/01.3/">1.3 Go 命令</a></li>
<li><a href="/buildWebWithGolangTw/docs/01.4/">1.4 Go 開發工具</a></li>
<li><a href="/buildWebWithGolangTw/docs/01.5/">1.5 小結</a></li>
</ul></li>
<li><a href="/buildWebWithGolangTw/docs/02.0/">2.Go 語言基礎</a>

<ul>
<li><a href="/buildWebWithGolangTw/docs/02.1/">2.1 你好，Go</a></li>
<li><a href="/buildWebWithGolangTw/docs/02.2/">2.2 Go 基礎</a></li>
<li><a href="/buildWebWithGolangTw/docs/02.3/">2.3 流程和函式</a></li>
<li><a href="/buildWebWithGolangTw/docs/02.4/">2.4 struct</a></li>
<li><a href="/buildWebWithGolangTw/docs/02.5/">2.5 物件導向</a></li>
<li><a href="/buildWebWithGolangTw/docs/02.6/">2.6 interface</a></li>
<li><a href="/buildWebWithGolangTw/docs/02.7/">2.7 併發</a></li>
<li><a href="/buildWebWithGolangTw/docs/02.8/">2.8 小結</a></li>
</ul></li>
<li><a href="/buildWebWithGolangTw/docs/03.0/">3.Web 基礎</a>

<ul>
<li><a href="/buildWebWithGolangTw/docs/03.1/">3.1 web 工作方式</a></li>
<li><a href="/buildWebWithGolangTw/docs/03.2/">3.2 Go 建立一個簡單的 web 服務</a></li>
<li><a href="/buildWebWithGolangTw/docs/03.3/">3.3 Go 如何使得 web 工作</a></li>
<li><a href="/buildWebWithGolangTw/docs/03.4/">3.4 Go 的 http 套件詳解</a></li>
<li><a href="/buildWebWithGolangTw/docs/03.5/">3.5 小結</a></li>
</ul></li>
<li><a href="/buildWebWithGolangTw/docs/04.0/">4.表單</a>

<ul>
<li><a href="/buildWebWithGolangTw/docs/04.1/">4.1 處理表單的輸入</a></li>
<li><a href="/buildWebWithGolangTw/docs/04.2/">4.2 驗證表單的輸入</a></li>
<li><a href="/buildWebWithGolangTw/docs/04.3/">4.3 預防跨站指令碼</a></li>
<li><a href="/buildWebWithGolangTw/docs/04.4/">4.4 防止多次提交表單</a></li>
<li><a href="/buildWebWithGolangTw/docs/04.5/">4.5 處理檔案上傳</a></li>
<li><a href="/buildWebWithGolangTw/docs/04.6/">4.6 小結</a></li>
</ul></li>
<li><a href="/buildWebWithGolangTw/docs/05.0/">5.訪問資料庫</a>

<ul>
<li><a href="/buildWebWithGolangTw/docs/05.1/">5.1 database/sql 介面</a></li>
<li><a href="/buildWebWithGolangTw/docs/05.2/">5.2 使用 MySQL 資料庫</a></li>
<li><a href="/buildWebWithGolangTw/docs/05.3/">5.3 使用 SQLite 資料庫</a></li>
<li><a href="/buildWebWithGolangTw/docs/05.4/">5.4 使用 PostgreSQL 資料庫</a></li>
<li><a href="/buildWebWithGolangTw/docs/05.5/">5.5 使用 Beego orm 函式庫進行 ORM 開發</a></li>
<li><a href="/buildWebWithGolangTw/docs/05.6/">5.6 NOSQL 資料庫操作</a></li>
<li><a href="/buildWebWithGolangTw/docs/05.7/">5.7 小結</a></li>
</ul></li>
<li><a href="/buildWebWithGolangTw/docs/06.0/">6.session 和資料儲存</a>

<ul>
<li><a href="/buildWebWithGolangTw/docs/06.1/">6.1 session 和 cookie</a></li>
<li><a href="/buildWebWithGolangTw/docs/06.2/">6.2 Go 如何使用 session</a></li>
<li><a href="/buildWebWithGolangTw/docs/06.3/">6.3 session 儲存</a></li>
<li><a href="/buildWebWithGolangTw/docs/06.4/">6.4 預防 session 劫持</a></li>
<li><a href="/buildWebWithGolangTw/docs/06.5/">6.5 小結</a></li>
</ul></li>
<li><a href="/buildWebWithGolangTw/docs/07.0/">7.文字檔案處理</a>

<ul>
<li><a href="/buildWebWithGolangTw/docs/07.1/">7.1 XML 處理</a></li>
<li><a href="/buildWebWithGolangTw/docs/07.2/">7.2 JSON 處理</a></li>
<li><a href="/buildWebWithGolangTw/docs/07.3/">7.3 正則處理</a></li>
<li><a href="/buildWebWithGolangTw/docs/07.4/">7.4 範本處理</a></li>
<li><a href="/buildWebWithGolangTw/docs/07.5/">7.5 檔案操作</a></li>
<li><a href="/buildWebWithGolangTw/docs/07.6/">7.6 字串處理</a></li>
<li><a href="/buildWebWithGolangTw/docs/07.7/">7.7 小結</a></li>
</ul></li>
<li><a href="/buildWebWithGolangTw/docs/08.0/">8.Web 服務</a>

<ul>
<li><a href="/buildWebWithGolangTw/docs/08.1/">8.1 Socket 程式設計</a></li>
<li><a href="/buildWebWithGolangTw/docs/08.2/">8.2 WebSocket</a></li>
<li><a href="/buildWebWithGolangTw/docs/08.3/">8.3 REST</a></li>
<li><a href="/buildWebWithGolangTw/docs/08.4/">8.4 RPC</a></li>
<li><a href="/buildWebWithGolangTw/docs/08.5/">8.5 小結</a></li>
</ul></li>
<li><a href="/buildWebWithGolangTw/docs/09.0/">9.安全與加密</a>

<ul>
<li><a href="/buildWebWithGolangTw/docs/09.1/">9.1 預防 CSRF 攻擊</a></li>
<li><a href="/buildWebWithGolangTw/docs/09.2/">9.2 確保輸入過濾</a></li>
<li><a href="/buildWebWithGolangTw/docs/09.3/">9.3 避免 XSS 攻擊</a></li>
<li><a href="/buildWebWithGolangTw/docs/09.4/">9.4 避免 SQL 注入</a></li>
<li><a href="/buildWebWithGolangTw/docs/09.5/">9.5 儲存密碼</a></li>
<li><a href="/buildWebWithGolangTw/docs/09.6/">9.6 加密和解密資料</a></li>
<li><a href="/buildWebWithGolangTw/docs/09.7/">9.7 小結</a></li>
</ul></li>
<li><a href="/buildWebWithGolangTw/docs/10.0/">10.國際化和本地化</a>

<ul>
<li><a href="/buildWebWithGolangTw/docs/10.1/">10.1 設定預設地區</a></li>
<li><a href="/buildWebWithGolangTw/docs/10.2/">10.2 本地化資源</a></li>
<li><a href="/buildWebWithGolangTw/docs/10.3/">10.3 國際化站點</a></li>
<li><a href="/buildWebWithGolangTw/docs/10.4/">10.4 小結</a></li>
</ul></li>
<li><a href="/buildWebWithGolangTw/docs/11.0/">11.錯誤處理，除錯和測試</a>

<ul>
<li><a href="/buildWebWithGolangTw/docs/11.1/">11.1 錯誤處理</a></li>
<li><a href="/buildWebWithGolangTw/docs/11.2/">11.2 使用 GDB 除錯</a></li>
<li><a href="/buildWebWithGolangTw/docs/11.3/">11.3 Go 怎麼寫測試案例</a></li>
<li><a href="/buildWebWithGolangTw/docs/11.4/">11.4 小結</a></li>
</ul></li>
<li><a href="/buildWebWithGolangTw/docs/12.0/">12.部署與維護</a>

<ul>
<li><a href="/buildWebWithGolangTw/docs/12.1/">12.1 應用日誌</a></li>
<li><a href="/buildWebWithGolangTw/docs/12.2/">12.2 網站錯誤處理</a></li>
<li><a href="/buildWebWithGolangTw/docs/12.3/">12.3 應用部署</a></li>
<li><a href="/buildWebWithGolangTw/docs/12.4/">12.4 備份和還原</a></li>
<li><a href="/buildWebWithGolangTw/docs/12.5/">12.5 小結</a></li>
</ul></li>
<li><a href="/buildWebWithGolangTw/docs/13.0/">13.如何設計一個 Web 框架</a>

<ul>
<li><a href="/buildWebWithGolangTw/docs/13.1/">13.1 專案規劃</a></li>
<li><a href="/buildWebWithGolangTw/docs/13.2/">13.2 自訂路由器設計</a></li>
<li><a href="/buildWebWithGolangTw/docs/13.3/">13.3 controller 設計</a></li>
<li><a href="/buildWebWithGolangTw/docs/13.4/">13.4 日誌和配置設計</a></li>
<li><a href="/buildWebWithGolangTw/docs/13.5/">13.5 實現部落格的增刪改</a></li>
<li><a href="/buildWebWithGolangTw/docs/13.6/">13.6 小結</a></li>
</ul></li>
<li><a href="/buildWebWithGolangTw/docs/14.0/">14.擴充套件 Web 框架</a>

<ul>
<li><a href="/buildWebWithGolangTw/docs/14.1/">14.1 靜態檔案支援</a></li>
<li><a href="/buildWebWithGolangTw/docs/14.2/">14.2 Session 支援</a></li>
<li><a href="/buildWebWithGolangTw/docs/14.3/">14.3 表單支援</a></li>
<li><a href="/buildWebWithGolangTw/docs/14.4/">14.4 使用者認證</a></li>
<li><a href="/buildWebWithGolangTw/docs/14.5/">14.5 多語言支援</a></li>
<li><a href="/buildWebWithGolangTw/docs/14.6/">14.6 pprof 支援</a></li>
<li><a href="/buildWebWithGolangTw/docs/14.7/">14.7 小結</a></li>
</ul></li>
<li><a href="/buildWebWithGolangTw/docs/ref/">附錄 A 參考資料</a></li>
</ul>







</nav>


<script>
(function() {
  var menu = document.querySelector("aside.book-menu nav");
  addEventListener("beforeunload", function(event) {
    localStorage.setItem("menu.scrollTop", menu.scrollTop);
  });
  menu.scrollTop = localStorage.getItem("menu.scrollTop");
})();
</script>

    </aside>

    <div class="book-page">
      <header class="flex align-center justify-between book-header">
  <label for="menu-control">
    <img src="/buildWebWithGolangTw/svg/menu.svg" alt="Menu" />
  </label>
  <strong>14.4</strong>
</header>

      
<article class="markdown">

<h1 id="14-4-使用者認證">14.4 使用者認證</h1>

<p>在開發 Web 應用過程中，使用者認證是開發者經常遇到的問題，使用者登入、註冊、登出等操作，而一般認證也分為三個方面的認證</p>

<ul>
<li>HTTP Basic 和 HTTP Digest 認證</li>
<li>第三方整合認證：QQ、微博、豆瓣、OPENID、google、github、facebook 和 twitter 等</li>
<li>自訂的使用者登入、註冊、登出，一般都是基於 session、cookie 認證</li>
</ul>

<p>beego 目前沒有針對這三種方式進行任何形式的整合，但是可以充分的利用第三方開源函式庫來實現上面的三種方式的使用者認證，不過後續 beego 會對前面兩種認證逐步整合。</p>

<h2 id="http-basic-和-http-digest-認證">HTTP Basic 和 HTTP Digest 認證</h2>

<p>這兩個認證是一些應用採用的比較簡單的認證，目前已經有開源的第三方函式庫支援這兩個認證：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Go" data-lang="Go"><span style="color:#a6e22e">github</span>.<span style="color:#a6e22e">com</span><span style="color:#f92672">/</span><span style="color:#a6e22e">abbot</span><span style="color:#f92672">/</span><span style="color:#66d9ef">go</span><span style="color:#f92672">-</span><span style="color:#a6e22e">http</span><span style="color:#f92672">-</span><span style="color:#a6e22e">auth</span></code></pre></div>
<p>下面程式碼示範了如何把這個函式庫引入 beego 中從而實現認證：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Go" data-lang="Go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">controllers</span>

<span style="color:#f92672">import</span> (
	<span style="color:#e6db74">&#34;github.com/abbot/go-http-auth&#34;</span>
	<span style="color:#e6db74">&#34;github.com/astaxie/beego&#34;</span>
)

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">Secret</span>(<span style="color:#a6e22e">user</span>, <span style="color:#a6e22e">realm</span> <span style="color:#66d9ef">string</span>) <span style="color:#66d9ef">string</span> {
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">user</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;john&#34;</span> {
		<span style="color:#75715e">// password is &#34;hello&#34;
</span><span style="color:#75715e"></span>		<span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;$1$dlPL2MqE$oQmn16q49SqdmhenQuNgs1&#34;</span>
	}
	<span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;&#34;</span>
}

<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">MainController</span> <span style="color:#66d9ef">struct</span> {
	<span style="color:#a6e22e">beego</span>.<span style="color:#a6e22e">Controller</span>
}

<span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">this</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">MainController</span>) <span style="color:#a6e22e">Prepare</span>() {
	<span style="color:#a6e22e">a</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">auth</span>.<span style="color:#a6e22e">NewBasicAuthenticator</span>(<span style="color:#e6db74">&#34;example.com&#34;</span>, <span style="color:#a6e22e">Secret</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">username</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">a</span>.<span style="color:#a6e22e">CheckAuth</span>(<span style="color:#a6e22e">this</span>.<span style="color:#a6e22e">Ctx</span>.<span style="color:#a6e22e">Request</span>); <span style="color:#a6e22e">username</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;&#34;</span> {
		<span style="color:#a6e22e">a</span>.<span style="color:#a6e22e">RequireAuth</span>(<span style="color:#a6e22e">this</span>.<span style="color:#a6e22e">Ctx</span>.<span style="color:#a6e22e">ResponseWriter</span>, <span style="color:#a6e22e">this</span>.<span style="color:#a6e22e">Ctx</span>.<span style="color:#a6e22e">Request</span>)
	}
}

<span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">this</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">MainController</span>) <span style="color:#a6e22e">Get</span>() {
	<span style="color:#a6e22e">this</span>.<span style="color:#a6e22e">Data</span>[<span style="color:#e6db74">&#34;Username&#34;</span>] = <span style="color:#e6db74">&#34;astaxie&#34;</span>
	<span style="color:#a6e22e">this</span>.<span style="color:#a6e22e">Data</span>[<span style="color:#e6db74">&#34;Email&#34;</span>] = <span style="color:#e6db74">&#34;astaxie@gmail.com&#34;</span>
	<span style="color:#a6e22e">this</span>.<span style="color:#a6e22e">TplNames</span> = <span style="color:#e6db74">&#34;index.tpl&#34;</span>
}</code></pre></div>
<p>上面程式碼利用了 beego 的 prepare 函式，在執行正常邏輯之前呼叫了認證函式，這樣就非常簡單的實現了 http auth，digest 的認證也是同樣的原理。</p>

<h2 id="oauth-和-oauth2-的認證">oauth 和 oauth2 的認證</h2>

<p>oauth 和 oauth2 是目前比較流行的兩種認證方式，還好第三方有一個函式庫實現了這個認證，但是是國外實現的，並沒有 QQ、微博之類別的國內應用認證整合：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Go" data-lang="Go"><span style="color:#a6e22e">github</span>.<span style="color:#a6e22e">com</span><span style="color:#f92672">/</span><span style="color:#a6e22e">bradrydzewski</span><span style="color:#f92672">/</span><span style="color:#66d9ef">go</span>.<span style="color:#a6e22e">auth</span></code></pre></div>
<p>下面程式碼示範了如何把該函式庫引入 beego 中從而實現 oauth 的認證，這裡以 github 為例示範：</p>

<ol>
<li><p>新增兩條路由</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Go" data-lang="Go"><span style="color:#a6e22e">beego</span>.<span style="color:#a6e22e">RegisterController</span>(<span style="color:#e6db74">&#34;/auth/login&#34;</span>, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">controllers</span>.<span style="color:#a6e22e">GithubController</span>{})
<span style="color:#a6e22e">beego</span>.<span style="color:#a6e22e">RegisterController</span>(<span style="color:#e6db74">&#34;/mainpage&#34;</span>, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">controllers</span>.<span style="color:#a6e22e">PageController</span>{})</code></pre></div></li>

<li><p>然後我們處理 GithubController 登陸的頁面：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Go" data-lang="Go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">controllers</span>

<span style="color:#f92672">import</span> (
	<span style="color:#e6db74">&#34;github.com/astaxie/beego&#34;</span>
	<span style="color:#e6db74">&#34;github.com/bradrydzewski/go.auth&#34;</span>
)

<span style="color:#66d9ef">const</span> (
	<span style="color:#a6e22e">githubClientKey</span> = <span style="color:#e6db74">&#34;a0864ea791ce7e7bd0df&#34;</span>
	<span style="color:#a6e22e">githubSecretKey</span> = <span style="color:#e6db74">&#34;a0ec09a647a688a64a28f6190b5a0d2705df56ca&#34;</span>
)

<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">GithubController</span> <span style="color:#66d9ef">struct</span> {
	<span style="color:#a6e22e">beego</span>.<span style="color:#a6e22e">Controller</span>
}

<span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">this</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">GithubController</span>) <span style="color:#a6e22e">Get</span>() {
	<span style="color:#75715e">// set the auth parameters
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">auth</span>.<span style="color:#a6e22e">Config</span>.<span style="color:#a6e22e">CookieSecret</span> = []byte(<span style="color:#e6db74">&#34;7H9xiimk2QdTdYI7rDddfJeV&#34;</span>)
	<span style="color:#a6e22e">auth</span>.<span style="color:#a6e22e">Config</span>.<span style="color:#a6e22e">LoginSuccessRedirect</span> = <span style="color:#e6db74">&#34;/mainpage&#34;</span>
	<span style="color:#a6e22e">auth</span>.<span style="color:#a6e22e">Config</span>.<span style="color:#a6e22e">CookieSecure</span> = <span style="color:#66d9ef">false</span>

	<span style="color:#a6e22e">githubHandler</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">auth</span>.<span style="color:#a6e22e">Github</span>(<span style="color:#a6e22e">githubClientKey</span>, <span style="color:#a6e22e">githubSecretKey</span>)

	<span style="color:#a6e22e">githubHandler</span>.<span style="color:#a6e22e">ServeHTTP</span>(<span style="color:#a6e22e">this</span>.<span style="color:#a6e22e">Ctx</span>.<span style="color:#a6e22e">ResponseWriter</span>, <span style="color:#a6e22e">this</span>.<span style="color:#a6e22e">Ctx</span>.<span style="color:#a6e22e">Request</span>)
}</code></pre></div></li>

<li><p>處理登陸成功之後的頁面</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Go" data-lang="Go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">controllers</span>

<span style="color:#f92672">import</span> (
	<span style="color:#e6db74">&#34;github.com/astaxie/beego&#34;</span>
	<span style="color:#e6db74">&#34;github.com/bradrydzewski/go.auth&#34;</span>
	<span style="color:#e6db74">&#34;net/http&#34;</span>
	<span style="color:#e6db74">&#34;net/url&#34;</span>
)

<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">PageController</span> <span style="color:#66d9ef">struct</span> {
	<span style="color:#a6e22e">beego</span>.<span style="color:#a6e22e">Controller</span>
}

<span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">this</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">PageController</span>) <span style="color:#a6e22e">Get</span>() {
	<span style="color:#75715e">// set the auth parameters
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">auth</span>.<span style="color:#a6e22e">Config</span>.<span style="color:#a6e22e">CookieSecret</span> = []byte(<span style="color:#e6db74">&#34;7H9xiimk2QdTdYI7rDddfJeV&#34;</span>)
	<span style="color:#a6e22e">auth</span>.<span style="color:#a6e22e">Config</span>.<span style="color:#a6e22e">LoginSuccessRedirect</span> = <span style="color:#e6db74">&#34;/mainpage&#34;</span>
	<span style="color:#a6e22e">auth</span>.<span style="color:#a6e22e">Config</span>.<span style="color:#a6e22e">CookieSecure</span> = <span style="color:#66d9ef">false</span>

	<span style="color:#a6e22e">user</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">auth</span>.<span style="color:#a6e22e">GetUserCookie</span>(<span style="color:#a6e22e">this</span>.<span style="color:#a6e22e">Ctx</span>.<span style="color:#a6e22e">Request</span>)

	<span style="color:#75715e">//if no active user session then authorize user
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">user</span>.<span style="color:#a6e22e">Id</span>() <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;&#34;</span> {
		<span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">Redirect</span>(<span style="color:#a6e22e">this</span>.<span style="color:#a6e22e">Ctx</span>.<span style="color:#a6e22e">ResponseWriter</span>, <span style="color:#a6e22e">this</span>.<span style="color:#a6e22e">Ctx</span>.<span style="color:#a6e22e">Request</span>, <span style="color:#a6e22e">auth</span>.<span style="color:#a6e22e">Config</span>.<span style="color:#a6e22e">LoginRedirect</span>, <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">StatusSeeOther</span>)
		<span style="color:#66d9ef">return</span>
	}

	<span style="color:#75715e">//else, add the user to the URL and continue
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">this</span>.<span style="color:#a6e22e">Ctx</span>.<span style="color:#a6e22e">Request</span>.<span style="color:#a6e22e">URL</span>.<span style="color:#a6e22e">User</span> = <span style="color:#a6e22e">url</span>.<span style="color:#a6e22e">User</span>(<span style="color:#a6e22e">user</span>.<span style="color:#a6e22e">Id</span>())
	<span style="color:#a6e22e">this</span>.<span style="color:#a6e22e">Data</span>[<span style="color:#e6db74">&#34;pic&#34;</span>] = <span style="color:#a6e22e">user</span>.<span style="color:#a6e22e">Picture</span>()
	<span style="color:#a6e22e">this</span>.<span style="color:#a6e22e">Data</span>[<span style="color:#e6db74">&#34;id&#34;</span>] = <span style="color:#a6e22e">user</span>.<span style="color:#a6e22e">Id</span>()
	<span style="color:#a6e22e">this</span>.<span style="color:#a6e22e">Data</span>[<span style="color:#e6db74">&#34;name&#34;</span>] = <span style="color:#a6e22e">user</span>.<span style="color:#a6e22e">Name</span>()
	<span style="color:#a6e22e">this</span>.<span style="color:#a6e22e">TplNames</span> = <span style="color:#e6db74">&#34;home.tpl&#34;</span>
}</code></pre></div></li>
</ol>

<p>整個的流程如下，首先開啟瀏覽器輸入地址：</p>

<p><img src="images/14.4.github.png" alt="" /></p>

<p>圖 14.4 顯示帶有登入按鈕的首頁</p>

<p>然後點選連結出現如下介面：</p>

<p><img src="images/14.4.github2.png" alt="" /></p>

<p>圖 14.5 點選登入按鈕後顯示 github 的授權頁</p>

<p>然後點選 Authorize app 就出現如下介面：</p>

<p><img src="images/14.4.github3.png" alt="" /></p>

<p>圖 14.6 授權登入之後顯示的取得到的 github 資訊頁</p>

<h2 id="自訂認證">自訂認證</h2>

<p>自訂的認證一般都是和 session 結合驗證的，如下程式碼來源於一個基於 beego 的開源部落格：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Go" data-lang="Go"><span style="color:#75715e">//登陸處理
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">this</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">LoginController</span>) <span style="color:#a6e22e">Post</span>() {
	<span style="color:#a6e22e">this</span>.<span style="color:#a6e22e">TplNames</span> = <span style="color:#e6db74">&#34;login.tpl&#34;</span>
	<span style="color:#a6e22e">this</span>.<span style="color:#a6e22e">Ctx</span>.<span style="color:#a6e22e">Request</span>.<span style="color:#a6e22e">ParseForm</span>()
	<span style="color:#a6e22e">username</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">this</span>.<span style="color:#a6e22e">Ctx</span>.<span style="color:#a6e22e">Request</span>.<span style="color:#a6e22e">Form</span>.<span style="color:#a6e22e">Get</span>(<span style="color:#e6db74">&#34;username&#34;</span>)
	<span style="color:#a6e22e">password</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">this</span>.<span style="color:#a6e22e">Ctx</span>.<span style="color:#a6e22e">Request</span>.<span style="color:#a6e22e">Form</span>.<span style="color:#a6e22e">Get</span>(<span style="color:#e6db74">&#34;password&#34;</span>)
	<span style="color:#a6e22e">md5Password</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">md5</span>.<span style="color:#a6e22e">New</span>()
	<span style="color:#a6e22e">io</span>.<span style="color:#a6e22e">WriteString</span>(<span style="color:#a6e22e">md5Password</span>, <span style="color:#a6e22e">password</span>)
	<span style="color:#a6e22e">buffer</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">bytes</span>.<span style="color:#a6e22e">NewBuffer</span>(<span style="color:#66d9ef">nil</span>)
	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Fprintf</span>(<span style="color:#a6e22e">buffer</span>, <span style="color:#e6db74">&#34;%x&#34;</span>, <span style="color:#a6e22e">md5Password</span>.<span style="color:#a6e22e">Sum</span>(<span style="color:#66d9ef">nil</span>))
	<span style="color:#a6e22e">newPass</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">buffer</span>.<span style="color:#a6e22e">String</span>()

	<span style="color:#a6e22e">now</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Now</span>().<span style="color:#a6e22e">Format</span>(<span style="color:#e6db74">&#34;2006-01-02 15:04:05&#34;</span>)

	<span style="color:#a6e22e">userInfo</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">models</span>.<span style="color:#a6e22e">GetUserInfo</span>(<span style="color:#a6e22e">username</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">userInfo</span>.<span style="color:#a6e22e">Password</span> <span style="color:#f92672">==</span> <span style="color:#a6e22e">newPass</span> {
		<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">users</span> <span style="color:#a6e22e">models</span>.<span style="color:#a6e22e">User</span>
		<span style="color:#a6e22e">users</span>.<span style="color:#a6e22e">Last_logintime</span> = <span style="color:#a6e22e">now</span>
		<span style="color:#a6e22e">models</span>.<span style="color:#a6e22e">UpdateUserInfo</span>(<span style="color:#a6e22e">users</span>)

		<span style="color:#75715e">//登入成功設定 session
</span><span style="color:#75715e"></span>
		<span style="color:#a6e22e">sess</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">globalSessions</span>.<span style="color:#a6e22e">SessionStart</span>(<span style="color:#a6e22e">this</span>.<span style="color:#a6e22e">Ctx</span>.<span style="color:#a6e22e">ResponseWriter</span>, <span style="color:#a6e22e">this</span>.<span style="color:#a6e22e">Ctx</span>.<span style="color:#a6e22e">Request</span>)
		<span style="color:#a6e22e">sess</span>.<span style="color:#a6e22e">Set</span>(<span style="color:#e6db74">&#34;uid&#34;</span>, <span style="color:#a6e22e">userInfo</span>.<span style="color:#a6e22e">Id</span>)
		<span style="color:#a6e22e">sess</span>.<span style="color:#a6e22e">Set</span>(<span style="color:#e6db74">&#34;uname&#34;</span>, <span style="color:#a6e22e">userInfo</span>.<span style="color:#a6e22e">Username</span>)

		<span style="color:#a6e22e">this</span>.<span style="color:#a6e22e">Ctx</span>.<span style="color:#a6e22e">Redirect</span>(<span style="color:#ae81ff">302</span>, <span style="color:#e6db74">&#34;/&#34;</span>)
	}
}

<span style="color:#75715e">//註冊處理
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">this</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">RegController</span>) <span style="color:#a6e22e">Post</span>() {
	<span style="color:#a6e22e">this</span>.<span style="color:#a6e22e">TplNames</span> = <span style="color:#e6db74">&#34;reg.tpl&#34;</span>
	<span style="color:#a6e22e">this</span>.<span style="color:#a6e22e">Ctx</span>.<span style="color:#a6e22e">Request</span>.<span style="color:#a6e22e">ParseForm</span>()
	<span style="color:#a6e22e">username</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">this</span>.<span style="color:#a6e22e">Ctx</span>.<span style="color:#a6e22e">Request</span>.<span style="color:#a6e22e">Form</span>.<span style="color:#a6e22e">Get</span>(<span style="color:#e6db74">&#34;username&#34;</span>)
	<span style="color:#a6e22e">password</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">this</span>.<span style="color:#a6e22e">Ctx</span>.<span style="color:#a6e22e">Request</span>.<span style="color:#a6e22e">Form</span>.<span style="color:#a6e22e">Get</span>(<span style="color:#e6db74">&#34;password&#34;</span>)
	<span style="color:#a6e22e">usererr</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">checkUsername</span>(<span style="color:#a6e22e">username</span>)
	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">usererr</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">usererr</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">false</span> {
		<span style="color:#a6e22e">this</span>.<span style="color:#a6e22e">Data</span>[<span style="color:#e6db74">&#34;UsernameErr&#34;</span>] = <span style="color:#e6db74">&#34;Username error, Please to again&#34;</span>
		<span style="color:#66d9ef">return</span>
	}

	<span style="color:#a6e22e">passerr</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">checkPassword</span>(<span style="color:#a6e22e">password</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">passerr</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">false</span> {
		<span style="color:#a6e22e">this</span>.<span style="color:#a6e22e">Data</span>[<span style="color:#e6db74">&#34;PasswordErr&#34;</span>] = <span style="color:#e6db74">&#34;Password error, Please to again&#34;</span>
		<span style="color:#66d9ef">return</span>
	}

	<span style="color:#a6e22e">md5Password</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">md5</span>.<span style="color:#a6e22e">New</span>()
	<span style="color:#a6e22e">io</span>.<span style="color:#a6e22e">WriteString</span>(<span style="color:#a6e22e">md5Password</span>, <span style="color:#a6e22e">password</span>)
	<span style="color:#a6e22e">buffer</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">bytes</span>.<span style="color:#a6e22e">NewBuffer</span>(<span style="color:#66d9ef">nil</span>)
	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Fprintf</span>(<span style="color:#a6e22e">buffer</span>, <span style="color:#e6db74">&#34;%x&#34;</span>, <span style="color:#a6e22e">md5Password</span>.<span style="color:#a6e22e">Sum</span>(<span style="color:#66d9ef">nil</span>))
	<span style="color:#a6e22e">newPass</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">buffer</span>.<span style="color:#a6e22e">String</span>()

	<span style="color:#a6e22e">now</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Now</span>().<span style="color:#a6e22e">Format</span>(<span style="color:#e6db74">&#34;2006-01-02 15:04:05&#34;</span>)

	<span style="color:#a6e22e">userInfo</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">models</span>.<span style="color:#a6e22e">GetUserInfo</span>(<span style="color:#a6e22e">username</span>)

	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">userInfo</span>.<span style="color:#a6e22e">Username</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;&#34;</span> {
		<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">users</span> <span style="color:#a6e22e">models</span>.<span style="color:#a6e22e">User</span>
		<span style="color:#a6e22e">users</span>.<span style="color:#a6e22e">Username</span> = <span style="color:#a6e22e">username</span>
		<span style="color:#a6e22e">users</span>.<span style="color:#a6e22e">Password</span> = <span style="color:#a6e22e">newPass</span>
		<span style="color:#a6e22e">users</span>.<span style="color:#a6e22e">Created</span> = <span style="color:#a6e22e">now</span>
		<span style="color:#a6e22e">users</span>.<span style="color:#a6e22e">Last_logintime</span> = <span style="color:#a6e22e">now</span>
		<span style="color:#a6e22e">models</span>.<span style="color:#a6e22e">AddUser</span>(<span style="color:#a6e22e">users</span>)

		<span style="color:#75715e">//登入成功設定 session
</span><span style="color:#75715e"></span>
		<span style="color:#a6e22e">sess</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">globalSessions</span>.<span style="color:#a6e22e">SessionStart</span>(<span style="color:#a6e22e">this</span>.<span style="color:#a6e22e">Ctx</span>.<span style="color:#a6e22e">ResponseWriter</span>, <span style="color:#a6e22e">this</span>.<span style="color:#a6e22e">Ctx</span>.<span style="color:#a6e22e">Request</span>)
		<span style="color:#a6e22e">sess</span>.<span style="color:#a6e22e">Set</span>(<span style="color:#e6db74">&#34;uid&#34;</span>, <span style="color:#a6e22e">userInfo</span>.<span style="color:#a6e22e">Id</span>)
		<span style="color:#a6e22e">sess</span>.<span style="color:#a6e22e">Set</span>(<span style="color:#e6db74">&#34;uname&#34;</span>, <span style="color:#a6e22e">userInfo</span>.<span style="color:#a6e22e">Username</span>)
		<span style="color:#a6e22e">this</span>.<span style="color:#a6e22e">Ctx</span>.<span style="color:#a6e22e">Redirect</span>(<span style="color:#ae81ff">302</span>, <span style="color:#e6db74">&#34;/&#34;</span>)
	} <span style="color:#66d9ef">else</span> {
		<span style="color:#a6e22e">this</span>.<span style="color:#a6e22e">Data</span>[<span style="color:#e6db74">&#34;UsernameErr&#34;</span>] = <span style="color:#e6db74">&#34;User already exists&#34;</span>
	}

}

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">checkPassword</span>(<span style="color:#a6e22e">password</span> <span style="color:#66d9ef">string</span>) (<span style="color:#a6e22e">b</span> <span style="color:#66d9ef">bool</span>) {
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">ok</span>, <span style="color:#a6e22e">_</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">regexp</span>.<span style="color:#a6e22e">MatchString</span>(<span style="color:#e6db74">&#34;^[a-zA-Z0-9]{4,16}$&#34;</span>, <span style="color:#a6e22e">password</span>); !<span style="color:#a6e22e">ok</span> {
		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>
	}
	<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span>
}

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">checkUsername</span>(<span style="color:#a6e22e">username</span> <span style="color:#66d9ef">string</span>) (<span style="color:#a6e22e">b</span> <span style="color:#66d9ef">bool</span>) {
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">ok</span>, <span style="color:#a6e22e">_</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">regexp</span>.<span style="color:#a6e22e">MatchString</span>(<span style="color:#e6db74">&#34;^[a-zA-Z0-9]{4,16}$&#34;</span>, <span style="color:#a6e22e">username</span>); !<span style="color:#a6e22e">ok</span> {
		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>
	}
	<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span>
}</code></pre></div>
<p>有了使用者登陸和註冊之後，其他模組的地方可以增加如下這樣的使用者是否登陸的判斷：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Go" data-lang="Go"><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">this</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">AddBlogController</span>) <span style="color:#a6e22e">Prepare</span>() {
	<span style="color:#a6e22e">sess</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">globalSessions</span>.<span style="color:#a6e22e">SessionStart</span>(<span style="color:#a6e22e">this</span>.<span style="color:#a6e22e">Ctx</span>.<span style="color:#a6e22e">ResponseWriter</span>, <span style="color:#a6e22e">this</span>.<span style="color:#a6e22e">Ctx</span>.<span style="color:#a6e22e">Request</span>)
	<span style="color:#a6e22e">sess_uid</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">sess</span>.<span style="color:#a6e22e">Get</span>(<span style="color:#e6db74">&#34;userid&#34;</span>)
	<span style="color:#a6e22e">sess_username</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">sess</span>.<span style="color:#a6e22e">Get</span>(<span style="color:#e6db74">&#34;username&#34;</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">sess_uid</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">this</span>.<span style="color:#a6e22e">Ctx</span>.<span style="color:#a6e22e">Redirect</span>(<span style="color:#ae81ff">302</span>, <span style="color:#e6db74">&#34;/admin/login&#34;</span>)
		<span style="color:#66d9ef">return</span>
	}
	<span style="color:#a6e22e">this</span>.<span style="color:#a6e22e">Data</span>[<span style="color:#e6db74">&#34;Username&#34;</span>] = <span style="color:#a6e22e">sess_username</span>
}</code></pre></div>
<h2 id="links">links</h2>

<ul>
<li><a href="docs/preface">目錄</a></li>
<li>上一節: <a href="docs/14.3">表單及驗證支援</a></li>
<li>下一節: <a href="docs/14.5">多語言支援</a></li>
</ul>
</article>

      
<div class="book-footer justify-between">
  
  <div>
    
    <a href="/commit/fda25aafea9413c8ec77f5df29d5f6bb5f7dc3a6" title='Last modified Sep 21, 2019 by Jiuxiao' target="_blank" rel="noopener">
      <img src="/buildWebWithGolangTw/svg/calendar.svg" alt="Changed" /> Sep 21, 2019
    </a>
  </div>
  
  
</div>


      
    </div>

    
  

  <aside class="book-toc level-3 fixed">
    <nav id="TableOfContents">
<ul>
<li><a href="#14-4-使用者認證">14.4 使用者認證</a>
<ul>
<li><a href="#http-basic-和-http-digest-認證">HTTP Basic 和 HTTP Digest 認證</a></li>
<li><a href="#oauth-和-oauth2-的認證">oauth 和 oauth2 的認證</a></li>
<li><a href="#自訂認證">自訂認證</a></li>
<li><a href="#links">links</a></li>
</ul></li>
</ul>
</nav>
  </aside>



  </main>

  
  
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-148025936-2', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

</body>

</html>
